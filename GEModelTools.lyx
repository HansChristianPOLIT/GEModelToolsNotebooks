#LyX 2.3 created this file. For more info see http://www.lyx.org/
\lyxformat 544
\begin_document
\begin_header
\save_transient_properties true
\origin unavailable
\textclass article
\begin_preamble
% general
\usepackage[titletoc]{appendix}
\usepackage{graphicx}
\usepackage{placeins}
\usepackage{tikz}

% algorithm
\usepackage[ruled,vlined,linesnumbered]{algorithm2e}
\IncMargin{2.5cm}
\DecMargin{2cm}
\usepackage{fullwidth}
\usepackage{enumitem}
\setlist{leftmargin=1.7cm}

% tables
\usepackage{tabularx, siunitx, multirow, booktabs}
\begingroup
% Allow `_` and `:` in macro names (LaTeX3 style)
\catcode`\_=11
\catcode`\:=11
% Internal code of `S`
\gdef\tabularxcolumn#1{%
    >{\__siunitx_table_collect_begin:Nn S{} }%
    p{#1}%  <- this is different (is `c` in normal `S`)
    <{\__siunitx_table_print:}%
}
\endgroup

% figures
\usepackage{subfig}
\usepackage{caption}
\captionsetup[subfloat]{position=top}

% footnotes
\setlength{\skip\footins}{1cm}
\usepackage[hang,splitrule]{footmisc}
\setlength{\footnotemargin}{0.3cm} %.5
\setlength{\footnotesep}{0.4cm}

% links
\hypersetup{colorlinks=true,citecolor=blue}
\hypersetup{colorlinks=true,linkcolor=blue}
\hypersetup{colorlinks=true,urlcolor=blue}

% code
\usepackage{xcolor}
\usepackage{listings}

\definecolor{codegray}{rgb}{0.5,0.5,0.5}
\definecolor{background}{HTML}{F5F5F5}
\definecolor{keyword}{HTML}{4B69C6}
\definecolor{string}{HTML}{448C27}
\definecolor{comment}{HTML}{448C27}

\usepackage{inconsolata}
\lstdefinestyle{mystyle}{
    commentstyle=\color{comment},
    keywordstyle=\color{keyword},
    stringstyle=\color{string},
    basicstyle=\ttfamily,
    breakatwhitespace=false,         
    breaklines=true,                 
    captionpos=b,                    
    keepspaces=true,                                    
    numbersep=5pt,                  
    showspaces=false,                
    showstringspaces=false,
    showtabs=false,
    tabsize=4,
	showlines=true
}

\lstset{style=mystyle}

% manual
\usepackage{enumitem}
\setlist[enumerate]{leftmargin=1cm}
\setlist[itemize]{leftmargin=0.5cm}
\end_preamble
\use_default_options true
\begin_modules
theorems-ams
\end_modules
\maintain_unincluded_children false
\language english
\language_package default
\inputencoding auto
\fontencoding global
\font_roman "lmodern" "default"
\font_sans "default" "default"
\font_typewriter "default" "default"
\font_math "auto" "auto"
\font_default_family default
\use_non_tex_fonts false
\font_sc false
\font_osf false
\font_sf_scale 100 100
\font_tt_scale 100 100
\use_microtype false
\use_dash_ligatures false
\graphics default
\default_output_format default
\output_sync 1
\bibtex_command default
\index_command default
\paperfontsize 11
\spacing onehalf
\use_hyperref false
\papersize a4paper
\use_geometry true
\use_package amsmath 1
\use_package amssymb 1
\use_package cancel 1
\use_package esint 1
\use_package mathdots 1
\use_package mathtools 1
\use_package mhchem 1
\use_package stackrel 1
\use_package stmaryrd 1
\use_package undertilde 1
\cite_engine natbib
\cite_engine_type authoryear
\biblio_style plainnat
\use_bibtopic false
\use_indices false
\paperorientation portrait
\suppress_date true
\justification true
\use_refstyle 1
\use_minted 0
\index Index
\shortcut idx
\color #008000
\end_index
\leftmargin 3cm
\topmargin 3cm
\rightmargin 3cm
\bottommargin 3cm
\secnumdepth 3
\tocdepth 3
\paragraph_separation skip
\defskip smallskip
\is_math_indent 0
\math_numbering_side default
\quotes_style danish
\dynamic_quotes 0
\papercolumns 1
\papersides 1
\paperpagestyle plain
\tracking_changes false
\output_changes false
\html_math_output 0
\html_css_as_file 0
\html_be_strict false
\end_header

\begin_body

\begin_layout Title

\series bold
The 
\series default

\begin_inset ERT
status open

\begin_layout Plain Layout


\backslash
lstinline{GEModelTools}
\end_layout

\end_inset


\series bold
 Package for
\begin_inset Newline newline
\end_inset

Solving HANK Models in Python
\end_layout

\begin_layout Author
Jeppe Druedahl
\begin_inset Newline newline
\end_inset

Emil Holst Partsch
\end_layout

\begin_layout Abstract
\begin_inset ERT
status open

\begin_layout Plain Layout


\backslash
noindent 
\end_layout

\end_inset

This note provides an overview of the 
\begin_inset ERT
status open

\begin_layout Plain Layout


\backslash
lstinline{GEModelTools}
\end_layout

\end_inset

 package for solving general equilibrium models easily in Python using the
 sequence-space method.
\begin_inset ERT
status open

\begin_layout Plain Layout


\backslash
vspace{1mm}
\end_layout

\end_inset


\end_layout

\begin_layout Abstract
\begin_inset ERT
status open

\begin_layout Plain Layout


\backslash
noindent 
\end_layout

\end_inset

You can learn how to use the package following these steps:
\begin_inset ERT
status open

\begin_layout Plain Layout


\backslash
vspace{1mm}
\end_layout

\end_inset


\end_layout

\begin_deeper
\begin_layout Enumerate
Read this document
\end_layout

\begin_layout Enumerate
Install the package 
\end_layout

\begin_layout Enumerate
Run the example notebooks
\end_layout

\begin_layout Enumerate
Read the commented code for the example notebooks
\end_layout

\begin_layout Enumerate
Implement your own model
\begin_inset ERT
status open

\begin_layout Plain Layout


\backslash
vspace{3mm}
\end_layout

\end_inset


\end_layout

\begin_layout Standard

\series bold
Course:
\series default
 
\begin_inset CommandInset href
LatexCommand href
name "Adv. Macro: Heterogenous Agent Models"
target "https://sites.google.com/view/numeconcph-advmacrohet/"
literal "false"

\end_inset


\end_layout

\begin_layout Standard
\begin_inset ERT
status open

\begin_layout Plain Layout


\backslash
noindent 
\end_layout

\end_inset


\series bold
Literature: 
\series default
\size small

\begin_inset CommandInset citation
LatexCommand citet
key "boppart_exploiting_2018"
literal "false"

\end_inset

 and 
\begin_inset CommandInset citation
LatexCommand citet
key "auclert_using_2021"
literal "false"

\end_inset


\size default
.
\begin_inset ERT
status open

\begin_layout Plain Layout


\backslash
vspace{3mm}
\end_layout

\end_inset


\end_layout

\begin_layout Standard
\begin_inset ERT
status open

\begin_layout Plain Layout


\backslash
noindent 
\end_layout

\end_inset


\series bold
\size large
Structure:
\end_layout

\begin_layout Itemize
\begin_inset ERT
status open

\begin_layout Plain Layout

[]
\end_layout

\end_inset


\series bold
Section 
\begin_inset CommandInset ref
LatexCommand ref
reference "sec:Model-class"
plural "false"
caps "false"
noprefix "false"

\end_inset


\series default
 describes the class of models considered
\end_layout

\begin_layout Itemize
\begin_inset ERT
status open

\begin_layout Plain Layout

[]
\end_layout

\end_inset


\series bold
Section 
\begin_inset CommandInset ref
LatexCommand ref
reference "sec:GEModelClass"
plural "false"
caps "false"
noprefix "false"

\end_inset


\series default
 explains the required user inputs and available methods
\end_layout

\begin_layout Itemize
\begin_inset ERT
status open

\begin_layout Plain Layout

[]
\end_layout

\end_inset


\series bold
Section 
\begin_inset CommandInset ref
LatexCommand ref
reference "sec:Efficient-computation-of"
plural "false"
caps "false"
noprefix "false"

\end_inset


\series default
 explains how to efficiently compute the household Jacobian
\end_layout

\begin_layout Itemize
\begin_inset ERT
status open

\begin_layout Plain Layout

[]
\end_layout

\end_inset


\series bold
Section 
\begin_inset CommandInset ref
LatexCommand ref
reference "sec:Additional-features"
plural "false"
caps "false"
noprefix "false"

\end_inset


\series default
 explains additional features
\end_layout

\begin_layout Itemize
\begin_inset ERT
status open

\begin_layout Plain Layout

[]
\end_layout

\end_inset


\series bold
Section 
\begin_inset CommandInset ref
LatexCommand ref
reference "sec:Troubleshooting"
plural "false"
caps "false"
noprefix "false"

\end_inset


\series default
 provides basic troubleshooting
\begin_inset ERT
status open

\begin_layout Plain Layout


\backslash
vspace{3mm}
\end_layout

\end_inset


\end_layout

\begin_layout Standard

\series bold
\size large
Code:
\series default
\size default

\begin_inset ERT
status open

\begin_layout Plain Layout


\backslash
vspace{1mm}
\end_layout

\end_inset


\begin_inset Newline newline
\end_inset

Package: 
\begin_inset CommandInset href
LatexCommand href
name "github.com/NumEconCopenhagen/GEModelTools"
target "https://github.com/NumEconCopenhagen/GEModelTools"
literal "false"

\end_inset


\begin_inset Newline newline
\end_inset

Notebooks: 
\begin_inset CommandInset href
LatexCommand href
name "github.com/NumEconCopenhagen/GEModelToolsNotebooks"
target "https://github.com/NumEconCopenhagen/GEModelToolsNotebooks"
literal "false"

\end_inset


\begin_inset ERT
status open

\begin_layout Plain Layout


\backslash
vspace{3mm}
\end_layout

\end_inset


\begin_inset Newline newline
\end_inset


\series bold
Requirements:
\series default
 Rely on 
\begin_inset ERT
status open

\begin_layout Plain Layout


\backslash
lstinline{EconModel}
\end_layout

\end_inset

 and 
\begin_inset ERT
status open

\begin_layout Plain Layout


\backslash
lstinline{ConSav}
\end_layout

\end_inset

.
\begin_inset ERT
status open

\begin_layout Plain Layout


\backslash
vspace{1mm}
\end_layout

\end_inset


\begin_inset Newline newline
\end_inset

Packages: 
\begin_inset Newline newline
\end_inset


\begin_inset CommandInset href
LatexCommand href
name "github.com/NumEconCopenhagen/EconModel"
target "https://github.com/NumEconCopenhagen/EconModel"
literal "false"

\end_inset


\begin_inset Newline newline
\end_inset


\begin_inset CommandInset href
LatexCommand href
name "github.com/NumEconCopenhagen/ConsumptionSaving"
target "https://github.com/NumEconCopenhagen/ConsumptionSaving"
literal "false"

\end_inset


\begin_inset ERT
status open

\begin_layout Plain Layout


\backslash
vspace{1mm}
\end_layout

\end_inset


\begin_inset Newline newline
\end_inset

Notebooks: 
\begin_inset Newline newline
\end_inset


\begin_inset CommandInset href
LatexCommand href
name "github.com/NumEconCopenhagen/EconModelNotebooks"
target "https://github.com/NumEconCopenhagen/EconModelNotebooks"
literal "false"

\end_inset


\begin_inset Newline newline
\end_inset


\begin_inset CommandInset href
LatexCommand href
name "github.com/NumEconCopenhagen/ConsumptionSavingNotebooks"
target "https://github.com/NumEconCopenhagen/ConsumptionSavingNotebooks"
literal "false"

\end_inset


\end_layout

\end_deeper
\begin_layout Standard
\begin_inset ERT
status open

\begin_layout Plain Layout


\backslash
thispagestyle{empty}
\end_layout

\begin_layout Plain Layout


\backslash
addtocounter{page}{-1}
\end_layout

\end_inset


\end_layout

\begin_layout Standard
\begin_inset Newpage newpage
\end_inset


\end_layout

\begin_layout Section
Model class
\begin_inset CommandInset label
LatexCommand label
name "sec:Model-class"

\end_inset


\end_layout

\begin_layout Standard
In this section, we describe the class of general equilibrium models with
 heterogeneous agents the package is designed solve, and explain how to
 use the 
\emph on
sequence space method
\emph default
 developed in 
\begin_inset CommandInset citation
LatexCommand citet
key "auclert_using_2021"
literal "false"

\end_inset

 to solve them.
 The starting point is a model with 
\emph on
perfect foresight
\emph default
, where the 
\emph on
non-linear transition path
\emph default
 can be found given the initial distribution of agents and a sequence of
 exogenous shocks.
 Next, we show how to solve for the 
\emph on
linearized impulse responses.
 
\emph default
These impulse responses are equal to those from a model with 
\emph on
aggregate risk
\emph default
 once it is linearized and certainty equivalence holds.
 This implies that the sequence space method can be used to simulate time-series
 data for aggregate variables and the distribution of agents.
 Throughout this note a simple 
\emph on
Heterogeneous Agent Neo-Classical
\emph default
 (HANC) is used as an example.
 In Appendix 
\begin_inset CommandInset ref
LatexCommand ref
reference "sec:HANK-model-with-endo-risk"
plural "false"
caps "false"
noprefix "false"

\end_inset

 a
\emph on
 Heterogeneous Agent New Keynesian 
\emph default
with 
\emph on
Search-And-Matching
\emph default
 (HANK-SAM) is considered.
\end_layout

\begin_layout Subsection
Model class
\end_layout

\begin_layout Standard
We consider economies where:
\end_layout

\begin_layout Enumerate
Time is discrete (index 
\begin_inset Formula $t$
\end_inset

).
\end_layout

\begin_layout Enumerate
There is a continuum of households (index 
\begin_inset Formula $i$
\end_inset

, when needed).
\end_layout

\begin_layout Enumerate
There is 
\emph on
perfect foresight
\emph default
 wrt.
 all aggregate variables, 
\begin_inset Formula $\boldsymbol{X}$
\end_inset

, indexed by 
\begin_inset Formula $\mathcal{N}$
\end_inset

,
\begin_inset Formula 
\[
\boldsymbol{X}=\{\boldsymbol{X}_{t}\}_{t=0}^{\infty}=\{\boldsymbol{X}^{j}\}_{j\in\mathcal{N}}=\{X_{t}^{j}\}_{t=0,j\in\mathcal{N}}^{\infty},
\]

\end_inset

where 
\begin_inset Formula $\mathcal{N}=\mathcal{Z}\cup\mathcal{U}\cup\mathcal{O}$
\end_inset

, and 
\begin_inset Formula $\mathcal{Z}$
\end_inset

 are 
\emph on
exogenous shocks, 
\begin_inset Formula $\mathcal{U}$
\end_inset

 
\emph default
are
\emph on
 unknowns
\emph default
, 
\begin_inset Formula $\mathcal{O}$
\end_inset

 are outputs, and 
\begin_inset Formula $\mathcal{H\in\mathcal{O}}$
\end_inset

 are 
\emph on
targets.
\end_layout

\begin_layout Enumerate
The model structure is described in terms of a set of 
\emph on
blocks 
\emph default
indexed by 
\begin_inset Formula $\mathcal{B}$
\end_inset

, where each block has inputs, 
\begin_inset Formula $\mathcal{I}_{b}\subset\mathcal{N}$
\end_inset

, and outputs, 
\begin_inset Formula $\mathcal{O}_{b}\subset\mathcal{O}$
\end_inset

, and there exists functions 
\begin_inset Formula $h^{o}(\{\boldsymbol{X}^{i}\}_{i\in\mathcal{I}_{b}})$
\end_inset

 for all 
\begin_inset Formula $o\in\mathcal{O}_{b}$
\end_inset

.
\end_layout

\begin_layout Enumerate
The blocks are 
\emph on
ordered
\emph default
 such that (i) each output is 
\emph on
unique
\emph default
 to a block, (ii) the first block only have shocks and unknowns as inputs,
 and (iii) later blocks only additionally take outputs of previous blocks
 as inputs.
 This implies the blocks can be structured as a 
\emph on
directed acyclical graph
\emph default
 (DAG).
\end_layout

\begin_layout Enumerate
The number of targets are equal to the number of unknowns, and an 
\emph on
equilibrium
\emph default
 implies 
\begin_inset Formula $\boldsymbol{X}^{o}=0$
\end_inset

 for all 
\begin_inset Formula $o\in\mathcal{H}$
\end_inset

.
 Equivalently, the model can be summarized by an 
\emph on
target equation system
\emph default
 from the unknowns and shocks to the targets,
\begin_inset Formula 
\begin{equation}
\boldsymbol{H(U,Z)=0},\label{eq:H}
\end{equation}

\end_inset

and an 
\emph on
auxiliary model equation
\emph default
 to infer all variables 
\begin_inset Formula 
\begin{equation}
\boldsymbol{X=M(U,Z).}\label{eq:M}
\end{equation}

\end_inset

A 
\emph on
steady state
\emph default
 satisfy
\begin_inset Formula 
\[
\boldsymbol{H(\boldsymbol{U}_{ss},\boldsymbol{Z}_{ss})}=0\text{ and \boldsymbol{X}_{ss}=\boldsymbol{M(}\boldsymbol{U_{ss}}\boldsymbol{,}\boldsymbol{Z}_{ss}\boldsymbol{)}.}
\]

\end_inset


\end_layout

\begin_layout Enumerate
The 
\emph on
discretized household block
\emph default
 can be written recursively as
\begin_inset Formula 
\begin{align}
\boldsymbol{v}_{t} & =v(\underline{\boldsymbol{v}}_{t+1},\boldsymbol{X}_{t}^{hh})\label{eq:v_general}\\
\underline{\boldsymbol{v}}_{t} & =\Pi(\boldsymbol{X}_{t}^{hh})\boldsymbol{v}_{t}\label{eq:v_ubar_general}\\
\boldsymbol{D}_{t} & =\Pi(\boldsymbol{X}_{t}^{hh})^{\prime}\underline{\boldsymbol{D}}_{t}\label{eq:D_exo_general}\\
\boldsymbol{\underline{\boldsymbol{D}}}_{t+1} & =\Lambda(\underline{\boldsymbol{v}}_{t+1},\boldsymbol{X}_{t}^{hh})^{\text{\prime}}\boldsymbol{D}_{t}\label{eq:D_endo_general}\\
\boldsymbol{a}_{t}^{\ast} & =\boldsymbol{a}^{\ast}(\underline{\boldsymbol{v}}_{t+1},\boldsymbol{X}_{t}^{hh})\label{eq:policy_generel}\\
\boldsymbol{Y}_{t}^{hh} & =\boldsymbol{y}(\underline{\boldsymbol{v}}_{t+1},\boldsymbol{X}_{t}^{hh})^{\prime}\boldsymbol{D}_{t}\label{eq:Y_general}\\
 & \text{where}\nonumber \\
 & \boldsymbol{\underline{D}}_{0}\text{ is given}\nonumber \\
 & \boldsymbol{X}_{t}^{hh}=\{\boldsymbol{X}_{t}^{i}\}_{i\in\mathcal{I}_{hh}}\nonumber \\
 & \boldsymbol{Y}_{t}^{hh}=\{\boldsymbol{X}_{t}^{o}\}_{o\in\mathcal{O}_{hh}},\nonumber 
\end{align}

\end_inset

where respectively 
\begin_inset Formula $\underline{\boldsymbol{v}}_{t}$
\end_inset

 and 
\begin_inset Formula $\boldsymbol{\underline{D}}_{t}$
\end_inset

 and 
\begin_inset Formula $\boldsymbol{v}_{t}$
\end_inset

 and 
\begin_inset Formula $\boldsymbol{D}_{t}$
\end_inset

 are the value functions and distributions 
\emph on
before
\emph default
 and 
\emph on
after
\emph default
 the realization of the idiosyncratic states with transition matrix 
\begin_inset Formula $\Pi(\boldsymbol{X}_{t}^{hh})$
\end_inset

, 
\begin_inset Formula $\boldsymbol{a}_{t}^{\ast}$
\end_inset

 is the policy functions, 
\begin_inset Formula $\boldsymbol{Y}_{t}$
\end_inset

 is aggregated outputs with 
\begin_inset Formula $y(\underline{\boldsymbol{v}}_{t+1},\boldsymbol{X}_{t}^{hh})$
\end_inset

 as individual level measures.
\end_layout

\begin_layout Enumerate
Given the sequence of shocks, 
\begin_inset Formula $\boldsymbol{Z},$
\end_inset

there exists a 
\emph on
truncation period
\emph default
, 
\begin_inset Formula $T$
\end_inset

, such all variables return to steady state beforehand.
\end_layout

\begin_layout Standard
It is straightforward to numerically evaluate the model starting from the
 shocks and unknowns going forward block by block along the directed acyclical
 graph (DAG).
 Derivatives can also be calculated along this graph to construct Jacobians.
 Computationally, the central challenge is to compute the derivatives of
 the household block.
 This can be done efficiently as explained below in section 
\begin_inset CommandInset ref
LatexCommand ref
reference "sec:Efficient-computation-of"
plural "false"
caps "false"
noprefix "false"

\end_inset

 with the so-called 
\begin_inset Quotes ald
\end_inset

fake new algorithm
\begin_inset Quotes ard
\end_inset

 from 
\begin_inset CommandInset citation
LatexCommand citet
key "auclert_using_2021"
literal "false"

\end_inset

.
 With the sequence-space Jacobians, the truncated equation system, 
\begin_inset Formula $\boldsymbol{H}(\boldsymbol{U},\boldsymbol{Z})=0$
\end_inset

, can be solved straightforwardly with a quasi-Newton solver (e.g.
 using Broyden's method).
\end_layout

\begin_layout Standard
Alternatively, the model can be solved to a first order by total differentiating
 equation 
\begin_inset CommandInset ref
LatexCommand eqref
reference "eq:H"
plural "false"
caps "false"
noprefix "false"

\end_inset


\end_layout

\begin_layout Standard
\begin_inset Formula 
\begin{align}
\boldsymbol{H}_{\boldsymbol{U}}d\boldsymbol{U}+\boldsymbol{H}_{\boldsymbol{Z}}d\boldsymbol{Z}=0 & \Leftrightarrow d\boldsymbol{U}=\underset{\text{\ensuremath{\equiv\boldsymbol{G}_{\boldsymbol{U}}}}}{\underbrace{-\boldsymbol{H}_{\boldsymbol{U}}^{-1}\boldsymbol{H}_{\boldsymbol{Z}}}}d\boldsymbol{Z},\label{eq:total_diff-1}
\end{align}

\end_inset

where we refer to 
\begin_inset Formula $\boldsymbol{G}_{U}$
\end_inset

 as the 
\emph on
general equilibrium solution matrix
\emph default
.
 By also total differentiating equation 
\begin_inset CommandInset ref
LatexCommand eqref
reference "eq:M"
plural "false"
caps "false"
noprefix "false"

\end_inset

, the remaining linearized impulse responses can be calculated as
\begin_inset Formula 
\begin{align*}
d\boldsymbol{X} & =M_{\boldsymbol{U}}d\boldsymbol{U}+M_{\boldsymbol{Z}}d\boldsymbol{Z}\\
 & =\underset{\equiv\boldsymbol{G}}{\underbrace{(-M_{\boldsymbol{U}}\boldsymbol{H}_{\boldsymbol{U}}^{-1}\boldsymbol{H}_{\boldsymbol{Z}}+M_{\boldsymbol{Z}})}}d\boldsymbol{Z.}
\end{align*}

\end_inset

where 
\begin_inset Formula $\boldsymbol{G}$
\end_inset

 is the full 
\emph on
general equilibrium matrix
\emph default
.
\end_layout

\begin_layout Subsection
Example: A simple HANC-model
\end_layout

\begin_layout Standard
We now consider how a simple HANC-model fits into this setup.
\end_layout

\begin_layout Paragraph*
Firms.
 
\end_layout

\begin_layout Standard
A representative firm rent capital, 
\begin_inset Formula $K_{t-1}$
\end_inset

, and hire labor, 
\begin_inset Formula $L_{t}$
\end_inset

, to produce goods, with the production function
\begin_inset Formula 
\begin{equation}
Y_{t}=\Gamma_{t}K_{t-1}^{\alpha}L_{t}^{1-\alpha},\label{eq:Y}
\end{equation}

\end_inset

where 
\begin_inset Formula $\Gamma_{t}$
\end_inset

 is technology and considered an exogenous shock.
 Capital depreciates with the rate 
\begin_inset Formula $\delta$
\end_inset

.
 Profit maximization by
\begin_inset Formula 
\[
\max_{K_{t-1},L_{t}}Y_{t}-w_{t}L_{t}-r_{t}^{k}K_{t-1}
\]

\end_inset

implies the standard pricing equations
\series bold

\begin_inset Formula 
\begin{align}
r_{t}^{k} & =\alpha\Gamma_{t}(K_{t-1}/L_{t})^{\text{\alpha-1}}\label{eq:rk}\\
w_{t} & =(1-\alpha)\Gamma_{t}(K_{t-1}/L_{t})^{\alpha}\label{eq:w}
\end{align}

\end_inset


\series default
where 
\begin_inset Formula $r_{t}^{k}$
\end_inset

 is rental rate of capital and 
\begin_inset Formula $w_{t}$
\end_inset

 is the wage rate.
 The implied
\series bold
 
\series default
(real) interest rate is 
\begin_inset Formula $r_{t}=r_{t}^{k}-\delta$
\end_inset

.
\end_layout

\begin_layout Paragraph*
Households.
\end_layout

\begin_layout Standard
Households are heterogeneous ex ante with respect to their discount factor,
 
\begin_inset Formula $\beta_{i}$
\end_inset

, and ex post with respect to their productivity, 
\begin_inset Formula $z_{t}$
\end_inset

, and assets, 
\begin_inset Formula $a_{t-1}$
\end_inset

.
 Each period household exogenously supply 
\begin_inset Formula $z_{t}$
\end_inset

 units of labor, and choose consumption 
\begin_inset Formula $c_{t}$
\end_inset

 subject to a no-borrowing constraint.
 Households have 
\emph on
perfect foresight
\emph default
 wrt.
 to the interest rate and the wage rate, 
\begin_inset Formula $\{r_{t},w_{t}\}_{t=0}^{\infty}$
\end_inset

, and solve the problem
\begin_inset Formula 
\begin{align}
v_{t}(\beta_{i},z_{t},a_{t-1}) & =\max_{a_{t},c_{t}}\frac{c_{t}^{1-\sigma}}{1-\sigma}+\beta\mathbb{E}_{t}\left[v_{t+1}(\beta_{i},z_{t+1},a_{t})\right]\label{eq:Bellman_Aiyagari}\\
 & \text{s.t.}\nonumber \\
a_{t}+c_{t} & =(1+r_{t})a_{t-1}+w_{t}z_{t}\nonumber \\
\log z_{t} & =\rho_{z}\log z_{t-1}+\psi_{t}\,\,\,,\psi_{t}\sim\mathcal{N}(\mu_{\psi},\sigma_{\psi}),\,\mathbb{E}[z_{t}]=1\,\nonumber \\
a_{t} & \geq0,\nonumber 
\end{align}

\end_inset

where implicitly 
\begin_inset Formula $v_{t}(\beta_{i},z_{t},a_{t-1})=v(\beta_{i},z_{t},a_{t-1},\{r_{\tau},w_{\tau}\}_{\tau=t}^{\infty})$
\end_inset

.
 We denote optimal policy functions by 
\begin_inset Formula $a_{t}^{\ast}(\beta_{i},z_{t},a_{t-1})$
\end_inset

 and 
\begin_inset Formula $c_{t}^{\ast}(\beta_{i},z_{t},a_{t-1})$
\end_inset

.
\end_layout

\begin_layout Standard
The household problem is discretized, and optimal savings function, 
\begin_inset Formula $a^{\ast}$
\end_inset

, is computed on sorted grids for 
\begin_inset Formula $\beta_{i}$
\end_inset

, 
\begin_inset Formula $z_{t}$
\end_inset

 and 
\begin_inset Formula $a_{t-1}$
\end_inset

 generically denoted 
\begin_inset Formula $\mathcal{G}_{x}=\{x^{0},x^{1},\dots,x^{\#_{x-1}}\}$
\end_inset

.
 The transition probabilities for 
\begin_inset Formula $z_{t}$
\end_inset

 are denoted 
\begin_inset Formula $\pi_{i_{z-1},i_{z}}=\text{Pr}[z_{t}=z^{i_{z}}|z_{t-1}=z^{i_{z-}}]$
\end_inset

.
 We consider
\begin_inset Formula $\underline{\boldsymbol{D}}_{t}$
\end_inset

 and 
\begin_inset Formula $\boldsymbol{D}_{t}$
\end_inset

 to be histograms in terms of probability masses at each grid point.
 The following updating algorithm can now be used given 
\begin_inset Formula $\underline{\boldsymbol{D}}_{t}$
\end_inset


\end_layout

\begin_layout Enumerate
Stochastic simulation: For each 
\begin_inset Formula $i_{\beta}$
\end_inset

, 
\begin_inset Formula $i_{z}$
\end_inset

 and 
\begin_inset Formula $i_{a-}$
\end_inset

 calculate
\begin_inset Formula 
\[
\boldsymbol{D}_{t}(\beta^{i_{\beta}},z^{i_{z}},a^{i_{a-}})=\sum_{i_{z-}=0}^{\text{\#}_{z}-1}\pi_{i_{z-},i_{z}}\boldsymbol{\underline{\boldsymbol{D}}}_{t}(\beta^{i_{\beta}},z^{i_{z-}},a^{i_{a-}})
\]

\end_inset


\end_layout

\begin_layout Enumerate
Initial zero mass: Set 
\begin_inset Formula $\underline{\boldsymbol{D}}_{t+1}(\beta^{i_{\beta}},z^{i_{z}},a^{i_{a}})=0$
\end_inset

 for all 
\begin_inset Formula $i_{\beta}$
\end_inset

, 
\begin_inset Formula $i_{z+}$
\end_inset

 and 
\begin_inset Formula $i_{a}$
\end_inset


\end_layout

\begin_layout Enumerate
Choice simulation: For each 
\begin_inset Formula $i_{\beta}$
\end_inset

, 
\begin_inset Formula $i_{z}$
\end_inset

 and 
\begin_inset Formula $i_{a-}$
\end_inset

 do
\end_layout

\begin_deeper
\begin_layout Enumerate
Find 
\begin_inset Formula $\iota\equiv\text{largest }i_{a}\in\{0,1,\dots,\#_{a}-2\}$
\end_inset

 such that 
\begin_inset Formula $a^{i_{a}}\leq a_{t}^{\ast}(\beta^{i_{\beta}},z^{i_{z}},a^{i_{a-}})$
\end_inset


\end_layout

\begin_layout Enumerate
Calculate 
\begin_inset Formula $\omega=\frac{a^{\iota+1}-a^{\ast}(z^{i_{z}},a^{i_{a-}})}{a^{\iota+1}-a^{\iota}}\in[0,1]$
\end_inset


\end_layout

\begin_layout Enumerate
Increment 
\begin_inset Formula $\underline{\boldsymbol{D}}_{t+1}(\beta^{i_{\beta}},z^{i_{z}},a^{\iota})$
\end_inset

 with 
\begin_inset Formula $\omega\boldsymbol{D}_{t}(\beta^{i_{\beta}},z^{i_{z}},a^{i_{a-}})$
\end_inset


\end_layout

\begin_layout Enumerate
Increment 
\begin_inset Formula $\boldsymbol{\underline{\boldsymbol{D}}}_{t+1}(\beta^{i_{\beta}},z^{i_{z}},a^{\iota+1})$
\end_inset

 with 
\begin_inset Formula $(1-\omega)\boldsymbol{D}_{t}(\beta^{i_{\beta}},z^{i_{z}},a^{i_{a-}})$
\end_inset


\end_layout

\end_deeper
\begin_layout Standard
This algorithm first use the exogenous transition probabilities, 
\begin_inset Formula $\pi_{i_{z-},i_{z}}$
\end_inset

, to simulate forward from the beginning-of-period distribution, 
\begin_inset Formula $\underline{\boldsymbol{D}}_{t}$
\end_inset

, to the choice-relevant distribution, 
\begin_inset Formula $\boldsymbol{D}_{t}$
\end_inset

.
 It secondly derives the next-period beginning-of-period distribution, 
\begin_inset Formula $\underline{\boldsymbol{D}}_{t+1}$
\end_inset

, by distributes probability mass to the neighboring grids points of the
 optimal savings choice (indexed by 
\begin_inset Formula $\iota$
\end_inset

) using linear weights, 
\begin_inset Formula $\omega$
\end_inset

.
 In matrix form the simulation can be written asThe histogram method can
 be 
\begin_inset Formula 
\begin{align*}
\boldsymbol{D}_{t} & =\Pi_{z}^{\prime}\underline{\boldsymbol{D}}_{t}\\
\underline{\boldsymbol{D}}_{t+1} & =\Lambda_{t}\boldsymbol{D}_{t}
\end{align*}

\end_inset

where the stochastic transition matrix 
\begin_inset Formula $\Pi_{z}^{\prime}$
\end_inset

 is derived from the 
\begin_inset Formula $\pi_{i_{z-},i_{z}}$
\end_inset

's, and the choice transition matrix is derived from the 
\begin_inset Formula $\iota$
\end_inset

's and 
\begin_inset Formula $\omega$
\end_inset

's.
\end_layout

\begin_layout Standard
The aggregate supply of savings can be calculated as
\begin_inset Formula 
\begin{align}
A_{t}^{hh} & =\int a_{t}^{\ast}(\beta_{i},z_{t},a_{t-1})d\boldsymbol{D}_{t}\label{eq:Ahh}\\
 & =\sum_{i_{\beta}}\sum_{i_{z}}\sum_{i_{a}}a_{t}^{\ast}(\beta_{i},z_{t},a_{t-1})\boldsymbol{D}_{t}(\beta^{i_{\beta}},z^{i_{z}},a^{i_{a}})\nonumber \\
 & =\boldsymbol{a}_{t}^{\ast\prime}\boldsymbol{D}_{t}\nonumber 
\end{align}

\end_inset

and aggregate consumption can be calculated as
\begin_inset Formula 
\begin{align}
C_{t}^{hh} & =\int c_{t}^{\ast}(\beta_{i},z_{t},a_{t-1})d\boldsymbol{D}_{t}\label{eq:Chh}\\
 & =\sum_{i_{\beta}}\sum_{i_{z}}\sum_{i_{a}}c_{t}^{\ast}(\beta_{i},z_{t},a_{t-1})\boldsymbol{D}_{t}(\beta^{i_{\beta}},z^{i_{z}},a^{i_{a}})\nonumber \\
 & =\boldsymbol{c}_{t}^{\ast\prime}\boldsymbol{D}_{t}\nonumber 
\end{align}

\end_inset


\end_layout

\begin_layout Paragraph*
Market clearing.
\end_layout

\begin_layout Standard
Market clearing requires
\begin_inset Formula 
\begin{align*}
\text{Labour: }L_{t} & =\int z_{t}dD_{t}=1\\
\text{Capital: }K_{t} & =A_{t}^{hh}\\
\text{Goods: }Y_{t} & =C_{t}^{hh}+K_{t}-K_{t-1}+\delta K_{t-1}
\end{align*}

\end_inset


\end_layout

\begin_layout Paragraph*
Stationary equilibrium.
\end_layout

\begin_layout Standard
The 
\emph on
stationary equilibrium
\emph default
 (steady state for aggregate variables) for a given 
\begin_inset Formula $\Gamma_{ss}$
\end_inset

 is
\end_layout

\begin_layout Enumerate
Quantities 
\begin_inset Formula $K_{ss}$
\end_inset

 and 
\begin_inset Formula $L_{ss},$
\end_inset

 
\end_layout

\begin_layout Enumerate
prices 
\begin_inset Formula $r_{ss}$
\end_inset

 and 
\begin_inset Formula $w_{ss},$
\end_inset


\end_layout

\begin_layout Enumerate
a distribution 
\begin_inset Formula $\boldsymbol{D}_{ss}$
\end_inset

 over 
\begin_inset Formula $z_{t-1}$
\end_inset

 and 
\begin_inset Formula $a_{t-1}$
\end_inset


\end_layout

\begin_layout Enumerate
and policy functions 
\begin_inset Formula $a_{ss}^{\ast}(z_{t},a_{t-1})$
\end_inset

 and 
\begin_inset Formula $c_{ss}^{\ast}(z_{t},a_{t-1})$
\end_inset


\end_layout

\begin_layout Standard
are such that
\end_layout

\begin_layout Enumerate
\begin_inset Formula $a_{ss}^{\ast}(\bullet)$
\end_inset

 and 
\begin_inset Formula $c_{ss}^{\ast}(\bullet)$
\end_inset

 solves the household problem with 
\begin_inset Formula $\{r_{ss},w_{ss}\}_{t=0}^{\infty}$
\end_inset


\end_layout

\begin_layout Enumerate
\begin_inset Formula $\boldsymbol{D}_{ss}=\Lambda_{ss}^{\prime}\Pi_{ss}^{\prime}\boldsymbol{D}_{ss}$
\end_inset

 is the invariant distribution implied by the household problem
\end_layout

\begin_layout Enumerate
Firms maximize profits, 
\begin_inset Formula $r_{ss}=\alpha A_{ss}(K_{ss}/L_{ss})^{\alpha-1}$
\end_inset

 and 
\begin_inset Formula $w_{ss}=(1-\alpha)A_{ss}\left(\frac{r_{t}+\delta}{\alpha A_{ss}}\right)^{\frac{\alpha}{\alpha-1}}$
\end_inset


\end_layout

\begin_layout Enumerate
The labor market clears, i.e.
 
\begin_inset Formula $L_{ss}=\int z_{ss}dD_{ss}=1$
\end_inset


\end_layout

\begin_layout Enumerate
The capital market clears, i.e.
 
\begin_inset Formula $K_{ss}=\int a_{ss}^{\ast}(\beta_{i},z_{t},a_{t-1})dD_{ss}$
\end_inset


\end_layout

\begin_layout Enumerate
The goods market clears, i.e.
 
\begin_inset Formula $Y_{ss}=\int c_{ss}^{\ast}(\beta_{i},z_{t},a_{t-1})dD_{ss}+\delta K_{ss}$
\end_inset


\end_layout

\begin_layout Standard
This is a root-finding problem, which can be solved as follows:
\end_layout

\begin_layout Enumerate
Guess on 
\begin_inset Formula $r_{ss}$
\end_inset


\end_layout

\begin_layout Enumerate
Calculate 
\begin_inset Formula $w_{ss}$
\end_inset


\end_layout

\begin_layout Enumerate
Solve the infinite horizon household problem
\end_layout

\begin_layout Enumerate
Simulate until convergence of 
\begin_inset Formula $\boldsymbol{D}_{ss}$
\end_inset


\end_layout

\begin_layout Enumerate
Calculate supply 
\begin_inset Formula $A_{ss}^{hh}=\boldsymbol{a}_{ss}^{\ast\prime}\boldsymbol{D}_{ss}$
\end_inset


\end_layout

\begin_layout Enumerate
Calculate demand 
\begin_inset Formula $K_{ss}=\left(\frac{r_{ss}+\delta}{\alpha Z_{ss}}\right)^{\frac{1}{\alpha-1}}L_{ss}$
\end_inset


\end_layout

\begin_layout Enumerate
If for some tolerance 
\begin_inset Formula $\epsilon$
\end_inset


\begin_inset Formula 
\[
\left|A_{ss}^{hh}-K_{ss}\right|<\epsilon
\]

\end_inset

then stop, otherwise update 
\begin_inset Formula $r_{ss}$
\end_inset

 appropriately and return to step 2
\end_layout

\begin_layout Paragraph*
Transition path.
\end_layout

\begin_layout Standard
In terms of the general formulation above, we can write the model in terms
 of
\end_layout

\begin_layout Enumerate
Shocks: 
\begin_inset Formula $\boldsymbol{Z}=\{\boldsymbol{\Gamma}\}$
\end_inset


\end_layout

\begin_layout Enumerate
Unknowns: 
\begin_inset Formula $\boldsymbol{U}=\{\boldsymbol{K}\}$
\end_inset


\end_layout

\begin_layout Enumerate
Targets: 
\begin_inset Formula $\{K_{t}-A_{t}^{hh}\}$
\end_inset

 (asset market clearing)
\end_layout

\begin_layout Enumerate
Aggregate variables: 
\begin_inset Formula $\boldsymbol{X}=\{\boldsymbol{\boldsymbol{\Gamma}},\boldsymbol{K},\boldsymbol{r},\boldsymbol{w},\boldsymbol{L},\boldsymbol{C},\boldsymbol{Y},\boldsymbol{A}^{hh},\boldsymbol{C}^{hh}\}$
\end_inset


\end_layout

\begin_layout Enumerate
Household inputs: 
\begin_inset Formula $\boldsymbol{X}_{t}^{hh}=\{\boldsymbol{r},\boldsymbol{w}\}$
\end_inset


\end_layout

\begin_layout Enumerate
Household outputs: 
\begin_inset Formula $\boldsymbol{Y}_{t}^{hh}=\{\boldsymbol{A}^{hh},\boldsymbol{C}^{hh}\}$
\end_inset


\end_layout

\begin_layout Standard
This implies the equation system
\size small

\begin_inset Formula 
\begin{align}
\boldsymbol{H}(\boldsymbol{K},\boldsymbol{\Gamma}) & =\boldsymbol{0}\Leftrightarrow\label{eq:H_Ayagari}\\
\left[\begin{array}{c}
K_{t}-A_{t}^{hh}\end{array}\right] & =\left[\begin{array}{c}
0\end{array}\right],\,\,\,\forall t\in\{0,1,\dots,T-1\}\nonumber 
\end{align}

\end_inset


\size default
where we have
\begin_inset Formula 
\begin{align*}
L_{t} & =1\\
r_{t} & =\alpha\Gamma_{t}(K_{t-1}/L_{t})^{\alpha-1}\\
w_{t} & =(1-\alpha)\Gamma_{t}\left(\frac{r_{t}+\delta}{\alpha\Gamma_{t}}\right)^{\frac{\alpha}{\alpha-1}}\\
A_{t}^{hh} & =\boldsymbol{a}_{t}^{\ast\prime}\boldsymbol{D}_{t}\\
\boldsymbol{D}_{t} & =\Pi_{z}^{\prime}\underline{\boldsymbol{D}}_{t}\\
\underline{\boldsymbol{D}}_{t+1} & =\Lambda_{t}\boldsymbol{D}_{t}\\
 & \boldsymbol{\underline{D}}_{0}\text{ is given}
\end{align*}

\end_inset


\begin_inset Formula 
\[
\boldsymbol{H}(\boldsymbol{K}^{0},\boldsymbol{\Gamma})=\boldsymbol{H}_{K}(\boldsymbol{K}_{ss},)(\boldsymbol{K}^{0}-\boldsymbol{K}_{ss})
\]

\end_inset


\begin_inset Formula 
\begin{align*}
\boldsymbol{K}^{1} & =\boldsymbol{H}_{K}^{-1}\boldsymbol{H}(\boldsymbol{K}^{0},\boldsymbol{\Gamma})\\
\boldsymbol{K}^{2} & =\boldsymbol{H}_{K}^{-1}\boldsymbol{H}(\boldsymbol{K}^{0},\boldsymbol{\Gamma})
\end{align*}

\end_inset


\end_layout

\begin_layout Standard
The sequence-space solution method described above can therefore be used
 to find the non-linear transition for an arbitrary sequence for for 
\begin_inset Formula $\Gamma_{t}$
\end_inset

.
 The full Jacobians can be written as
\begin_inset Formula 
\begin{align}
\boldsymbol{H}_{\boldsymbol{K}} & =\mathcal{J}^{A^{hh},r}\mathcal{J}^{r,K}+\mathcal{J}^{A^{hh},w}\mathcal{J}^{w,K}-\boldsymbol{I}\label{eq:H_K}\\
\boldsymbol{H}_{\boldsymbol{Z}} & =\mathcal{J}^{A^{hh},r}\mathcal{J}^{r,Z}+\mathcal{J}^{A^{hh},w}\mathcal{J}^{w,Z}\label{eq:H_Z}
\end{align}

\end_inset

where 
\begin_inset Formula $\mathcal{J}^{A^{hh},\bullet}$
\end_inset

 are the Jacobians of the household problem, which must be found numerically,
 and 
\begin_inset Formula $\mathcal{J}^{\bullet,K}$
\end_inset

 and 
\begin_inset Formula $\mathcal{J}^{\bullet,Z}$
\end_inset

 are the Jacobians of the firm block, which can in principle be found analytical
ly.
\end_layout

\begin_layout Subsection
Aggregate risk and simulation
\end_layout

\begin_layout Standard
The sequence-space solution method above was used to solve with 
\emph on
perfect foresight
\emph default
 with respect to all aggregate variables.
 The linearized impulse responses can, however, be shown to also be the
 linearized impulse responses in a model with aggregate risk, where 
\begin_inset Formula $\boldsymbol{Z}_{t}$
\end_inset

 is a 
\begin_inset Formula $MA(\infty)$
\end_inset

 process with coefficient 
\begin_inset Formula $d\boldsymbol{Z}_{s}$
\end_inset

 for 
\begin_inset Formula $s\in\{0,1,\dots\}$
\end_inset

 driven by the innovation 
\begin_inset Formula $\boldsymbol{\epsilon}_{t}$
\end_inset

.
 
\end_layout

\begin_layout Standard
For a time series of the innovations, 
\begin_inset Formula $\tilde{\boldsymbol{\epsilon}}_{t}$
\end_inset

, the resulting time series of the shocks and all endogenous variables can
 be computed 
\emph on
with truncation
\emph default
 by
\begin_inset Formula 
\begin{align}
d\tilde{\boldsymbol{Z}}_{t} & =\sum_{s=0}^{T}d\boldsymbol{Z}_{s}\tilde{\boldsymbol{\epsilon}}_{t-s}\label{eq:dZ_sim}\\
d\tilde{\boldsymbol{X}}_{t} & =\sum_{s=0}^{T}d\boldsymbol{X}_{s}\tilde{\boldsymbol{\epsilon}}_{t-s}\label{eq:dX_sim}
\end{align}

\end_inset

where 
\begin_inset Formula $d\boldsymbol{X}_{s}$
\end_inset

 is the value of the impulse response function 
\begin_inset Formula $s$
\end_inset

 periods after the shock has arrived.
 
\end_layout

\begin_layout Standard
To simulate a panel of household, we need to know how the policy functions
 change.
 Let 
\begin_inset Formula $\partial\boldsymbol{a}_{i_{g}}^{\star}/\partial X_{k}^{hh}$
\end_inset

 be the derivative of the policy function at grid point 
\begin_inset Formula $i_{g}$
\end_inset

 to a 
\begin_inset Formula $k$
\end_inset

 periods ahead shock to input 
\begin_inset Formula $X^{hh}$
\end_inset

.
 The impulse responses for each grind point then is then computed using
 the product rule 
\end_layout

\begin_layout Standard
\begin_inset Formula 
\[
da_{i_{g},s}^{\star}=\sum_{s^{\prime}=s}^{T-1}\sum_{X^{hh}\in\boldsymbol{X}^{hh}}\frac{\partial a_{i_{g}}^{\star}}{\partial X_{s^{\prime}-s}^{hh}}dX_{s^{\prime}}^{hh}.
\]

\end_inset

The time path of the policy can then be computed as
\begin_inset Formula 
\[
\boldsymbol{a}_{i_{g}}^{\star}=\sum_{s=0}^{T}da_{i_{g},s}^{\star}\tilde{\boldsymbol{\epsilon}}_{t-s},
\]

\end_inset

and a panel of households can be simulated using the standard updating rule
 for the distribution.
\end_layout

\begin_layout Subsubsection
Simple HANC-model
\end_layout

\begin_layout Standard
Assume that 
\begin_inset Formula $\Gamma_{t}$
\end_inset

 is an AR(1) process driven by Gaussian shocks with standard deviation 
\begin_inset Formula $\sigma$
\end_inset

 then 
\begin_inset Formula $d\boldsymbol{Z}=d\boldsymbol{\Gamma}=\left[\begin{array}{cccc}
1 & \rho & \rho^{2} & \cdots\end{array}\right]^{\prime}$
\end_inset

and 
\begin_inset Formula $\epsilon_{t}\sim\mathcal{N}(0,1)$
\end_inset

 and the general formular above applies.
\begin_inset Newpage newpage
\end_inset


\end_layout

\begin_layout Section
Using the 
\begin_inset ERT
status open

\begin_layout Plain Layout


\backslash
lstinline{GEModelClass}
\end_layout

\end_inset


\begin_inset CommandInset label
LatexCommand label
name "sec:GEModelClass"

\end_inset


\end_layout

\begin_layout Standard
The central tool in 
\begin_inset ERT
status open

\begin_layout Plain Layout


\backslash
lstinline{GEModelTools}
\end_layout

\end_inset

 is the 
\begin_inset ERT
status open

\begin_layout Plain Layout


\backslash
lstinline{GEModelClass}
\end_layout

\end_inset

, which is an add-on to the basic 
\begin_inset ERT
status open

\begin_layout Plain Layout


\backslash
lstinline{EconModelClass}
\end_layout

\end_inset

 (documented 
\begin_inset CommandInset href
LatexCommand href
name "here"
target "https://github.com/NumEconCopenhagen/EconModel"
literal "false"

\end_inset

).
 An example of the setup is shown in Listing 
\begin_inset CommandInset ref
LatexCommand ref
reference "lst:setup"
plural "false"
caps "false"
noprefix "false"

\end_inset

.
 The three methods 
\begin_inset ERT
status open

\begin_layout Plain Layout


\backslash
lstinline{.settings()}
\end_layout

\end_inset

, 
\begin_inset ERT
status open

\begin_layout Plain Layout


\backslash
lstinline{.setup()}
\end_layout

\end_inset

 and 
\begin_inset ERT
status open

\begin_layout Plain Layout


\backslash
lstinline{.allocate()}
\end_layout

\end_inset

 are all called automatically when the model is created.
\end_layout

\begin_layout Standard
A 
\begin_inset ERT
status open

\begin_layout Plain Layout


\backslash
lstinline{model}
\end_layout

\end_inset

 of the 
\begin_inset ERT
status open

\begin_layout Plain Layout


\backslash
lstinline{GEModelClass}
\end_layout

\end_inset

 consists of the following list of 
\begin_inset ERT
status open

\begin_layout Plain Layout


\backslash
lstinline{namespaces}
\end_layout

\end_inset

:
\end_layout

\begin_layout Enumerate
\begin_inset ERT
status open

\begin_layout Plain Layout


\backslash
vspace{-1mm}
\end_layout

\end_inset


\series bold
Parameters:
\series default
 
\begin_inset ERT
status open

\begin_layout Plain Layout


\backslash
lstinline{.par}
\end_layout

\end_inset


\end_layout

\begin_layout Enumerate
\begin_inset ERT
status open

\begin_layout Plain Layout


\backslash
vspace{-3mm}
\end_layout

\end_inset


\series bold
Steady state:
\series default
 
\begin_inset ERT
status open

\begin_layout Plain Layout


\backslash
lstinline{.ss}
\end_layout

\end_inset


\end_layout

\begin_layout Enumerate
\begin_inset ERT
status open

\begin_layout Plain Layout


\backslash
vspace{-3mm}
\end_layout

\end_inset


\series bold
Transition path:
\series default
 
\begin_inset ERT
status open

\begin_layout Plain Layout


\backslash
lstinline{.path}
\end_layout

\end_inset


\end_layout

\begin_layout Enumerate
\begin_inset ERT
status open

\begin_layout Plain Layout


\backslash
vspace{-3mm}
\end_layout

\end_inset


\series bold
Simulation:
\series default
 
\begin_inset ERT
status open

\begin_layout Plain Layout


\backslash
lstinline{.sim}
\end_layout

\end_inset


\end_layout

\begin_layout Enumerate
\begin_inset ERT
status open

\begin_layout Plain Layout


\backslash
vspace{-3mm}
\end_layout

\end_inset


\series bold
Initial state:
\series default
 
\begin_inset ERT
status open

\begin_layout Plain Layout


\backslash
lstinline{.ini}
\end_layout

\end_inset


\end_layout

\begin_layout Standard
The user is required to specify some 
\series bold
variable lists
\series default
 in 
\begin_inset ERT
status open

\begin_layout Plain Layout


\backslash
lstinline{.settings()}
\end_layout

\end_inset

 for:
\end_layout

\begin_layout Enumerate
\begin_inset ERT
status open

\begin_layout Plain Layout


\backslash
vspace{-3mm}
\end_layout

\end_inset


\series bold
Aggregate variables:
\series default
 
\begin_inset ERT
status open

\begin_layout Plain Layout


\backslash
lstinline{.varlist}
\end_layout

\end_inset

.
 
\begin_inset Newline newline
\end_inset

Used as 
\begin_inset ERT
status open

\begin_layout Plain Layout


\backslash
lstinline{path.VARNAME}
\end_layout

\end_inset

.
\end_layout

\begin_layout Enumerate
\begin_inset ERT
status open

\begin_layout Plain Layout


\backslash
vspace{-3mm}
\end_layout

\end_inset


\series bold
Household grids:
\series default
 
\begin_inset ERT
status open

\begin_layout Plain Layout


\backslash
lstinline{.grid_hh}
\end_layout

\end_inset

.
 
\begin_inset Newline newline
\end_inset

Used as 
\begin_inset ERT
status open

\begin_layout Plain Layout


\backslash
lstinline{par.VARNAME_grid}
\end_layout

\end_inset

.
\end_layout

\begin_layout Enumerate
\begin_inset ERT
status open

\begin_layout Plain Layout


\backslash
vspace{-3mm}
\end_layout

\end_inset


\series bold
Household inputs, direct:
\series default
 
\begin_inset ERT
status open

\begin_layout Plain Layout


\backslash
lstinline{.inputs_hh}
\end_layout

\end_inset

.
\begin_inset Newline newline
\end_inset

Must be in 
\begin_inset ERT
status open

\begin_layout Plain Layout


\backslash
lstinline{.varlist}
\end_layout

\end_inset

.
\end_layout

\begin_layout Enumerate
\begin_inset ERT
status open

\begin_layout Plain Layout


\backslash
vspace{-3mm}
\end_layout

\end_inset


\series bold
Household inputs, to transition matrix:
\series default
 
\begin_inset ERT
status open

\begin_layout Plain Layout


\backslash
lstinline{.inputs_hh_z}
\end_layout

\end_inset

.
\begin_inset Newline newline
\end_inset

Must be in 
\begin_inset ERT
status open

\begin_layout Plain Layout


\backslash
lstinline{.varlist}
\end_layout

\end_inset

.
\end_layout

\begin_layout Enumerate
\begin_inset ERT
status open

\begin_layout Plain Layout


\backslash
vspace{-3mm}
\end_layout

\end_inset


\series bold
Household outputs:
\series default
 
\begin_inset ERT
status open

\begin_layout Plain Layout


\backslash
lstinline{.outputs_hh}
\end_layout

\end_inset

.
\begin_inset Newline newline
\end_inset

Must 
\emph on
not 
\emph default
be in 
\begin_inset ERT
status open

\begin_layout Plain Layout


\backslash
lstinline{.varlist}
\end_layout

\end_inset

.
\begin_inset Newline newline
\end_inset

The aggregate variable 
\begin_inset ERT
status open

\begin_layout Plain Layout


\backslash
lstinline{VARNAME.upper()_hh}
\end_layout

\end_inset

 must be in 
\begin_inset ERT
status open

\begin_layout Plain Layout


\backslash
lstinline{.varlist_hh}
\end_layout

\end_inset

.
\end_layout

\begin_layout Enumerate
\begin_inset ERT
status open

\begin_layout Plain Layout


\backslash
vspace{-3mm}
\end_layout

\end_inset


\series bold
Household policy functions:
\series default
 
\begin_inset ERT
status open

\begin_layout Plain Layout


\backslash
lstinline{.pols_hh}
\end_layout

\end_inset

.
\begin_inset Newline newline
\end_inset

Must be subset of 
\begin_inset ERT
status open

\begin_layout Plain Layout


\backslash
lstinline{.outputs_hh}
\end_layout

\end_inset

.
\end_layout

\begin_layout Enumerate
\begin_inset ERT
status open

\begin_layout Plain Layout


\backslash
vspace{-3mm}
\end_layout

\end_inset


\series bold
Household intertemporal variables:
\series default
 
\begin_inset ERT
status open

\begin_layout Plain Layout


\backslash
lstinline{.pols_hh}
\end_layout

\end_inset

.
\begin_inset Newline newline
\end_inset

Must 
\emph on
not 
\emph default
be in 
\begin_inset ERT
status open

\begin_layout Plain Layout


\backslash
lstinline{.varlist}
\end_layout

\end_inset

.
\end_layout

\begin_layout Enumerate
\begin_inset ERT
status open

\begin_layout Plain Layout


\backslash
vspace{-3mm}
\end_layout

\end_inset


\series bold
Shocks:
\series default
 
\begin_inset ERT
status open

\begin_layout Plain Layout


\backslash
lstinline{.shocks}
\end_layout

\end_inset

.
\begin_inset Newline newline
\end_inset

Should be in 
\begin_inset ERT
status open

\begin_layout Plain Layout


\backslash
lstinline{.varlist}
\end_layout

\end_inset

.
\end_layout

\begin_layout Enumerate
\begin_inset ERT
status open

\begin_layout Plain Layout


\backslash
vspace{-3mm}
\end_layout

\end_inset


\series bold
Unknowns:
\series default
 
\begin_inset ERT
status open

\begin_layout Plain Layout


\backslash
lstinline{.unknowns}
\end_layout

\end_inset

.
\begin_inset Newline newline
\end_inset

Should be in 
\begin_inset ERT
status open

\begin_layout Plain Layout


\backslash
lstinline{.varlist}
\end_layout

\end_inset

.
\end_layout

\begin_layout Enumerate
\begin_inset ERT
status open

\begin_layout Plain Layout


\backslash
vspace{-3mm}
\end_layout

\end_inset


\series bold
Targets:
\series default
 
\begin_inset ERT
status open

\begin_layout Plain Layout


\backslash
lstinline{.targets}
\end_layout

\end_inset

.
\begin_inset Newline newline
\end_inset

Should be in 
\begin_inset ERT
status open

\begin_layout Plain Layout


\backslash
lstinline{.varlist}
\end_layout

\end_inset

.
\end_layout

\begin_layout Standard
The user must choose the following 
\series bold
settings
\series default
 in 
\begin_inset ERT
status open

\begin_layout Plain Layout


\backslash
lstinline{.setup()}
\end_layout

\end_inset

:
\end_layout

\begin_layout Enumerate
\begin_inset ERT
status open

\begin_layout Plain Layout


\backslash
vspace{-1mm}
\end_layout

\end_inset


\series bold
Number of exogenous 
\emph on
fixed 
\emph default
states:
\series default
 
\begin_inset ERT
status open

\begin_layout Plain Layout


\backslash
lstinline{par.Nfix}
\end_layout

\end_inset


\end_layout

\begin_layout Enumerate
\begin_inset ERT
status open

\begin_layout Plain Layout


\backslash
vspace{-3mm}
\end_layout

\end_inset


\series bold
Number of exogenous 
\emph on
stochastic
\emph default
 states:
\series default
 
\begin_inset ERT
status open

\begin_layout Plain Layout


\backslash
lstinline{par.Nz}
\end_layout

\end_inset


\end_layout

\begin_layout Enumerate
\begin_inset ERT
status open

\begin_layout Plain Layout


\backslash
vspace{-3mm}
\end_layout

\end_inset


\series bold
Number of grid points for endogenous variables:
\series default
 
\begin_inset ERT
status open

\begin_layout Plain Layout


\backslash
lstinline{par.Nendo1}
\end_layout

\end_inset

, 
\begin_inset ERT
status open

\begin_layout Plain Layout


\backslash
lstinline{par.Nendo2}
\end_layout

\end_inset

,
\begin_inset Formula $\dots$
\end_inset


\begin_inset Newline newline
\end_inset

where 
\begin_inset ERT
status open

\begin_layout Plain Layout


\backslash
lstinline{endo1}
\end_layout

\end_inset

, 
\begin_inset ERT
status open

\begin_layout Plain Layout


\backslash
lstinline{endo2}
\end_layout

\end_inset

,
\begin_inset Formula $\dots$
\end_inset

, is in 
\begin_inset ERT
status open

\begin_layout Plain Layout


\backslash
lstinline{.grids_hh}
\end_layout

\end_inset


\end_layout

\begin_layout Enumerate
\begin_inset ERT
status open

\begin_layout Plain Layout


\backslash
vspace{-3mm}
\end_layout

\end_inset


\series bold
Length of transition period:
\series default
 
\begin_inset ERT
status open

\begin_layout Plain Layout


\backslash
lstinline{par.T}
\end_layout

\end_inset


\end_layout

\begin_layout Enumerate
\begin_inset ERT
status open

\begin_layout Plain Layout


\backslash
vspace{-3mm}
\end_layout

\end_inset


\series bold
Length of simulation:
\series default
 
\begin_inset ERT
status open

\begin_layout Plain Layout


\backslash
lstinline{par.simT}
\end_layout

\end_inset


\end_layout

\begin_layout Enumerate
\begin_inset ERT
status open

\begin_layout Plain Layout


\backslash
vspace{-3mm}
\end_layout

\end_inset


\series bold
For each shock in 
\series default

\begin_inset ERT
status open

\begin_layout Plain Layout


\backslash
lstinline{.shocks}
\end_layout

\end_inset


\series bold
:
\series default
 
\begin_inset Newline newline
\end_inset

Initial jump: 
\begin_inset ERT
status open

\begin_layout Plain Layout


\backslash
lstinline{par.jump_SHOCKNAME}
\end_layout

\end_inset


\begin_inset Newline newline
\end_inset

Persistence: 
\begin_inset ERT
status open

\begin_layout Plain Layout


\backslash
lstinline{par.rho_SHOCKNAME}
\end_layout

\end_inset


\begin_inset Newline newline
\end_inset

Standard deviation: 
\begin_inset ERT
status open

\begin_layout Plain Layout


\backslash
lstinline{par.std_SHOCKNAME}
\end_layout

\end_inset


\end_layout

\begin_layout Enumerate
\begin_inset ERT
status open

\begin_layout Plain Layout


\backslash
vspace{-3mm}
\end_layout

\end_inset


\series bold
Optional solver settings:
\begin_inset Newline newline
\end_inset

 
\series default

\begin_inset ERT
status open

\begin_layout Plain Layout


\backslash
lstinline{par.max_iter_solve}
\end_layout

\end_inset

, 
\begin_inset ERT
status open

\begin_layout Plain Layout


\backslash
lstinline{par.max_iter_simulate}
\end_layout

\end_inset

, 
\begin_inset ERT
status open

\begin_layout Plain Layout


\backslash
lstinline{par.max_iter_broyden}
\end_layout

\end_inset


\begin_inset Newline newline
\end_inset

 
\begin_inset ERT
status open

\begin_layout Plain Layout


\backslash
lstinline{par.tol_solve}
\end_layout

\end_inset

, 
\begin_inset ERT
status open

\begin_layout Plain Layout


\backslash
lstinline{par.tol_simulate}
\end_layout

\end_inset

, 
\begin_inset ERT
status open

\begin_layout Plain Layout


\backslash
lstinline{par.tol_broyden}
\end_layout

\end_inset


\end_layout

\begin_layout Standard
Define 
\begin_inset ERT
status open

\begin_layout Plain Layout


\backslash
lstinline{sol_shape = (par.Nfix,par.Nfix,par.Nendo1,par.Nendo1,...)}
\end_layout

\end_inset

.
 
\end_layout

\begin_layout Standard
In 
\begin_inset ERT
status open

\begin_layout Plain Layout


\backslash
lstinline{.allocate()}
\end_layout

\end_inset

 the internal 
\series bold
method 
\series default

\begin_inset ERT
status open

\begin_layout Plain Layout


\backslash
lstinline{.allocate_GE()}
\end_layout

\end_inset

 can now be called to allocate:
\end_layout

\begin_layout Enumerate
\begin_inset ERT
status open

\begin_layout Plain Layout


\backslash
vspace{-1mm}
\end_layout

\end_inset


\series bold
Exogenous grids and transition matrices:
\series default

\begin_inset Newline newline
\end_inset


\begin_inset ERT
status open

\begin_layout Plain Layout


\backslash
lstinline{par.z_grid}
\end_layout

\end_inset

, 
\begin_inset ERT
status open

\begin_layout Plain Layout


\backslash
lstinline{shape=(par.Nz,)}
\end_layout

\end_inset


\begin_inset Newline newline
\end_inset


\begin_inset ERT
status open

\begin_layout Plain Layout


\backslash
lstinline{ss.z_trans}
\end_layout

\end_inset

, 
\begin_inset ERT
status open

\begin_layout Plain Layout


\backslash
lstinline{shape=(par.Nfix,par.Nz,par.Nz)}
\end_layout

\end_inset


\begin_inset Newline newline
\end_inset


\begin_inset ERT
status open

\begin_layout Plain Layout


\backslash
lstinline{ss.Dz}
\end_layout

\end_inset

, 
\begin_inset ERT
status open

\begin_layout Plain Layout


\backslash
lstinline{shape=(par.Nfix,par.Nz,)}
\end_layout

\end_inset


\begin_inset Newline newline
\end_inset


\begin_inset ERT
status open

\begin_layout Plain Layout


\backslash
lstinline{path.z_trans}
\end_layout

\end_inset

, 
\begin_inset ERT
status open

\begin_layout Plain Layout


\backslash
lstinline{shape=(par.T,par.Nz,par.Nz)}
\end_layout

\end_inset


\begin_inset Newline newline
\end_inset


\begin_inset ERT
status open

\begin_layout Plain Layout


\backslash
lstinline{path.Dz}
\end_layout

\end_inset

, 
\begin_inset ERT
status open

\begin_layout Plain Layout


\backslash
lstinline{shape=(par.T,par.Nfix,par.Nz,)}
\end_layout

\end_inset


\begin_inset ERT
status open

\begin_layout Plain Layout


\backslash
vspace{1mm}
\end_layout

\end_inset


\series bold

\begin_inset Newline newline
\end_inset


\series default

\begin_inset ERT
status open

\begin_layout Plain Layout


\backslash
lstinline{sim.z_trans}
\end_layout

\end_inset

, 
\begin_inset ERT
status open

\begin_layout Plain Layout


\backslash
lstinline{shape=(par.simT,par.Nz,par.Nz)}
\end_layout

\end_inset


\begin_inset Newline newline
\end_inset


\begin_inset ERT
status open

\begin_layout Plain Layout


\backslash
lstinline{sim.Dz}
\end_layout

\end_inset

, 
\begin_inset ERT
status open

\begin_layout Plain Layout


\backslash
lstinline{shape=(par.simT,par.Nfix,par.Nz,)}
\end_layout

\end_inset


\begin_inset ERT
status open

\begin_layout Plain Layout


\backslash
vspace{1mm}
\end_layout

\end_inset


\series bold

\begin_inset Newline newline
\end_inset


\series default

\begin_inset ERT
status open

\begin_layout Plain Layout


\backslash
lstinline{ini.Dz}
\end_layout

\end_inset

, 
\begin_inset ERT
status open

\begin_layout Plain Layout


\backslash
lstinline{shape=(par.Nfix,par.Nz,)}
\end_layout

\end_inset


\series bold

\begin_inset Newline newline
\end_inset

Remark:
\series default
 
\begin_inset ERT
status open

\begin_layout Plain Layout


\backslash
lstinline{path.z_trans[t]}
\end_layout

\end_inset

 is the transition matrix from 
\begin_inset Formula $\underline{\boldsymbol{D}}_{t}$
\end_inset

 to 
\begin_inset Formula $\boldsymbol{D}_{t}$
\end_inset


\begin_inset ERT
status open

\begin_layout Plain Layout


\backslash
vspace{1mm}
\end_layout

\end_inset


\end_layout

\begin_layout Enumerate
\begin_inset ERT
status open

\begin_layout Plain Layout


\backslash
vspace{-3mm}
\end_layout

\end_inset


\series bold
Beginning-of-period distribution, 
\begin_inset Formula $\underline{\boldsymbol{D}}_{t}$
\end_inset

:
\series default
 
\begin_inset Newline newline
\end_inset


\begin_inset ERT
status open

\begin_layout Plain Layout


\backslash
lstinline{ss.Dbeg}
\end_layout

\end_inset

, 
\begin_inset ERT
status open

\begin_layout Plain Layout


\backslash
lstinline{shape=sol_shape}
\end_layout

\end_inset


\begin_inset Newline newline
\end_inset


\begin_inset ERT
status open

\begin_layout Plain Layout


\backslash
lstinline{path.Dbeg}
\end_layout

\end_inset

, 
\begin_inset ERT
status open

\begin_layout Plain Layout


\backslash
lstinline{shape=(par.T,*sol_shape)}
\end_layout

\end_inset


\begin_inset Newline newline
\end_inset


\begin_inset ERT
status open

\begin_layout Plain Layout


\backslash
lstinline{sim.Dbeg}
\end_layout

\end_inset

, 
\begin_inset ERT
status open

\begin_layout Plain Layout


\backslash
lstinline{shape=(par.simT,*sol_shape)}
\end_layout

\end_inset


\begin_inset Newline newline
\end_inset


\begin_inset ERT
status open

\begin_layout Plain Layout


\backslash
lstinline{ini.Dbeg}
\end_layout

\end_inset

, 
\begin_inset ERT
status open

\begin_layout Plain Layout


\backslash
lstinline{shape=sol_shape}
\end_layout

\end_inset


\end_layout

\begin_layout Enumerate
\begin_inset ERT
status open

\begin_layout Plain Layout


\backslash
vspace{-3mm}
\end_layout

\end_inset


\series bold
Choice-relevant distribution, 
\begin_inset Formula $\boldsymbol{D}_{t}$
\end_inset

:
\series default

\begin_inset Newline newline
\end_inset


\begin_inset ERT
status open

\begin_layout Plain Layout


\backslash
lstinline{ss.D}
\end_layout

\end_inset

, 
\begin_inset ERT
status open

\begin_layout Plain Layout


\backslash
lstinline{shape=sol_shape}
\end_layout

\end_inset


\begin_inset Newline newline
\end_inset


\begin_inset ERT
status open

\begin_layout Plain Layout


\backslash
lstinline{path.D}
\end_layout

\end_inset

, 
\begin_inset ERT
status open

\begin_layout Plain Layout


\backslash
lstinline{shape=(par.T,*sol_shape)}
\end_layout

\end_inset


\begin_inset Newline newline
\end_inset


\begin_inset ERT
status open

\begin_layout Plain Layout


\backslash
lstinline{sim.D}
\end_layout

\end_inset

, 
\begin_inset ERT
status open

\begin_layout Plain Layout


\backslash
lstinline{shape=(par.simT,*sol_shape)}
\end_layout

\end_inset


\end_layout

\begin_layout Enumerate
\begin_inset ERT
status open

\begin_layout Plain Layout


\backslash
vspace{-3mm}
\end_layout

\end_inset


\series bold
Household outputs in 
\series default

\begin_inset ERT
status open

\begin_layout Plain Layout


\backslash
lstinline{.outputs_hh}
\end_layout

\end_inset


\series bold
:
\series default

\begin_inset Newline newline
\end_inset


\begin_inset ERT
status open

\begin_layout Plain Layout


\backslash
lstinline{ss.OUTPUTNAME}
\end_layout

\end_inset

, 
\begin_inset ERT
status open

\begin_layout Plain Layout


\backslash
lstinline{shape=sol_shape}
\end_layout

\end_inset


\begin_inset Newline newline
\end_inset


\begin_inset ERT
status open

\begin_layout Plain Layout


\backslash
lstinline{path.OUTPUTNAME}
\end_layout

\end_inset

, 
\begin_inset ERT
status open

\begin_layout Plain Layout


\backslash
lstinline{shape=(par.T,*sol_shape)}
\end_layout

\end_inset


\begin_inset Newline newline
\end_inset


\begin_inset ERT
status open

\begin_layout Plain Layout


\backslash
lstinline{sim.OUTPUTNAME}
\end_layout

\end_inset

, 
\begin_inset ERT
status open

\begin_layout Plain Layout


\backslash
lstinline{shape=(par.simT,*sol_shape)}
\end_layout

\end_inset

 (only 
\begin_inset ERT
status open

\begin_layout Plain Layout


\backslash
lstinline{.pols_hh}
\end_layout

\end_inset

)
\begin_inset Newline newline
\end_inset

Aggregated variables:
\begin_inset Newline newline
\end_inset


\begin_inset ERT
status open

\begin_layout Plain Layout


\backslash
lstinline{ss.OUTPUTNAME.upper()_hh}
\end_layout

\end_inset

, scalar
\begin_inset Newline newline
\end_inset


\begin_inset ERT
status open

\begin_layout Plain Layout


\backslash
lstinline{path.OUTPUTNAME.upper()_hh}
\end_layout

\end_inset

, 
\begin_inset ERT
status open

\begin_layout Plain Layout


\backslash
lstinline{shape=(par.T,)}
\end_layout

\end_inset


\begin_inset Newline newline
\end_inset


\begin_inset ERT
status open

\begin_layout Plain Layout


\backslash
lstinline{sim.OUTPUTNAME.upper()_hh}
\end_layout

\end_inset

, 
\begin_inset ERT
status open

\begin_layout Plain Layout


\backslash
lstinline{shape=(par.simT,)}
\end_layout

\end_inset

 (only 
\begin_inset ERT
status open

\begin_layout Plain Layout


\backslash
lstinline{.pols_hh}
\end_layout

\end_inset

)
\begin_inset Newline newline
\end_inset


\begin_inset ERT
status open

\begin_layout Plain Layout


\backslash
lstinline{sim.OUTPUTNAME.upper()_hh_from_D}
\end_layout

\end_inset

, 
\begin_inset ERT
status open

\begin_layout Plain Layout


\backslash
lstinline{shape=(par.simT,)}
\end_layout

\end_inset

 (only 
\begin_inset ERT
status open

\begin_layout Plain Layout


\backslash
lstinline{.pols_hh}
\end_layout

\end_inset

)
\end_layout

\begin_layout Enumerate
\begin_inset ERT
status open

\begin_layout Plain Layout


\backslash
vspace{-3mm}
\end_layout

\end_inset


\series bold
Aggregate variables in 
\series default

\begin_inset ERT
status open

\begin_layout Plain Layout


\backslash
lstinline{.varlist}
\end_layout

\end_inset


\series bold
:
\series default

\begin_inset Newline newline
\end_inset


\begin_inset ERT
status open

\begin_layout Plain Layout


\backslash
lstinline{ss.VARNAME}
\end_layout

\end_inset

, scalar
\begin_inset ERT
status open

\begin_layout Plain Layout


\backslash
vspace{1mm}
\end_layout

\end_inset


\begin_inset Newline newline
\end_inset


\begin_inset ERT
status open

\begin_layout Plain Layout


\backslash
lstinline{ini.VARNAME}
\end_layout

\end_inset

, scalar
\begin_inset ERT
status open

\begin_layout Plain Layout


\backslash
vspace{1mm}
\end_layout

\end_inset


\begin_inset Newline newline
\end_inset


\begin_inset ERT
status open

\begin_layout Plain Layout


\backslash
lstinline{path.VARNAME}
\end_layout

\end_inset

, 
\begin_inset ERT
status open

\begin_layout Plain Layout


\backslash
lstinline{shape=(par.T,}
\backslash
lstinline{len(inputs_endo)}$
\backslash
times$
\backslash
lstinline{par.T})
\end_layout

\end_inset


\begin_inset Newline newline
\end_inset


\begin_inset ERT
status open

\begin_layout Plain Layout


\backslash
lstinline{sim.VARNAME}
\end_layout

\end_inset

, 
\begin_inset ERT
status open

\begin_layout Plain Layout


\backslash
lstinline{shape=(par.simT,)}
\end_layout

\end_inset


\begin_inset Newline newline
\end_inset


\series bold
Remark:
\series default

\begin_inset Newline newline
\end_inset


\begin_inset ERT
status open

\begin_layout Plain Layout


\backslash
lstinline{path.VARNAME[0,t]}
\end_layout

\end_inset

 is the value in period 
\begin_inset Formula $t$
\end_inset

.
\begin_inset Newline newline
\end_inset


\begin_inset ERT
status open

\begin_layout Plain Layout


\backslash
lstinline{path.VARNAME[i,t]}
\end_layout

\end_inset

 for 
\begin_inset Formula $i>0$
\end_inset

 should be considered 
\emph on
undefined behavior
\emph default
.
\begin_inset ERT
status open

\begin_layout Plain Layout


\backslash
vspace{1mm}
\end_layout

\end_inset


\end_layout

\begin_layout Enumerate
\begin_inset ERT
status open

\begin_layout Plain Layout


\backslash
vspace{-3mm}
\end_layout

\end_inset


\series bold
Household Jacobian
\series default
, 
\begin_inset ERT
status open

\begin_layout Plain Layout


\backslash
lstinline{.jac_hh}
\end_layout

\end_inset


\series bold
:
\series default

\begin_inset Newline newline
\end_inset


\begin_inset ERT
status open

\begin_layout Plain Layout


\backslash
lstinline{jac_hh[(OUTPUTNAME.upper()_hh,INPUTNAME)]}
\end_layout

\end_inset

, each 
\begin_inset ERT
status open

\begin_layout Plain Layout


\backslash
lstinline{shape=(par.T,par.T)}
\end_layout

\end_inset


\end_layout

\begin_layout Enumerate
\begin_inset ERT
status open

\begin_layout Plain Layout


\backslash
vspace{-3mm}
\end_layout

\end_inset


\series bold
Full Jacobian
\series default
, 
\begin_inset ERT
status open

\begin_layout Plain Layout


\backslash
lstinline{.jac}
\end_layout

\end_inset


\series bold
:
\series default

\begin_inset Newline newline
\end_inset


\begin_inset ERT
status open

\begin_layout Plain Layout


\backslash
lstinline{jac[(OUTPUTNAME,INPUTNAME)]}
\end_layout

\end_inset

, each 
\begin_inset ERT
status open

\begin_layout Plain Layout


\backslash
lstinline{shape=(par.T,par.T)}
\end_layout

\end_inset


\end_layout

\begin_layout Enumerate
\begin_inset ERT
status open

\begin_layout Plain Layout


\backslash
vspace{-3mm}
\end_layout

\end_inset


\series bold
Solution matrix:
\series default

\begin_inset Newline newline
\end_inset


\begin_inset Formula $\boldsymbol{H}_{\boldsymbol{U}}$
\end_inset

: 
\begin_inset ERT
status open

\begin_layout Plain Layout


\backslash
lstinline{H_U}
\end_layout

\end_inset

, with shape 
\begin_inset ERT
status open

\begin_layout Plain Layout


\backslash
lstinline{shape=(par.T,par.T)}
\end_layout

\end_inset


\begin_inset Newline newline
\end_inset


\begin_inset Formula $\boldsymbol{H}_{\boldsymbol{Z}}$
\end_inset

: 
\begin_inset ERT
status open

\begin_layout Plain Layout


\backslash
lstinline{H_Z}
\end_layout

\end_inset

, with shape 
\begin_inset ERT
status open

\begin_layout Plain Layout


\backslash
lstinline{shape=(par.T,par.T)}
\end_layout

\end_inset


\begin_inset Newline newline
\end_inset


\begin_inset Formula $\boldsymbol{G}_{U}$
\end_inset

: 
\begin_inset ERT
status open

\begin_layout Plain Layout


\backslash
lstinline{G_U}
\end_layout

\end_inset

, with shape 
\begin_inset ERT
status open

\begin_layout Plain Layout


\backslash
lstinline{shape=(par.T,par.T)}
\end_layout

\end_inset


\end_layout

\begin_layout Enumerate
\begin_inset ERT
status open

\begin_layout Plain Layout


\backslash
vspace{-3mm}
\end_layout

\end_inset


\series bold
Impulse-responses of linearized model
\series default
,
\series bold
 
\series default

\begin_inset ERT
status open

\begin_layout Plain Layout


\backslash
lstinline{.IRF}
\end_layout

\end_inset


\series bold
:
\series default

\begin_inset Newline newline
\end_inset


\begin_inset ERT
status open

\begin_layout Plain Layout


\backslash
lstinline{IRF[(OUTPUTNAME,SHOCKNAME)]}
\end_layout

\end_inset

, each 
\begin_inset ERT
status open

\begin_layout Plain Layout


\backslash
lstinline{shape=(par.T,)}
\end_layout

\end_inset


\end_layout

\begin_layout Standard
Finally, the user must also provide the following 
\series bold
methods
\series default
:
\end_layout

\begin_layout Enumerate
\begin_inset ERT
status open

\begin_layout Plain Layout


\backslash
vspace{-1mm}
\end_layout

\end_inset


\begin_inset ERT
status open

\begin_layout Plain Layout


\backslash
lstinline{.prephare_hh_ss()}
\end_layout

\end_inset

 (method), which creates the grids for all the variables in 
\begin_inset ERT
status open

\begin_layout Plain Layout


\backslash
lstinline{.par}
\end_layout

\end_inset

, creates the transition matrix 
\begin_inset ERT
status open

\begin_layout Plain Layout


\backslash
lstinline{ss.z_trans}
\end_layout

\end_inset

, choose the initial distributions 
\begin_inset ERT
status open

\begin_layout Plain Layout


\backslash
lstinline{ss.Dz}
\end_layout

\end_inset

 and 
\begin_inset ERT
status open

\begin_layout Plain Layout


\backslash
lstinline{ss.Dbeg}
\end_layout

\end_inset

, and choose the initial guesses for all variables in 
\begin_inset ERT
status open

\begin_layout Plain Layout


\backslash
lstinline{.intertemps_hh()}
\end_layout

\end_inset

 in 
\begin_inset ERT
status open

\begin_layout Plain Layout


\backslash
lstinline{.ss}
\end_layout

\end_inset

.
 This is called each time we solve for the steady state of the household
 problem
\emph on
 
\emph default
using in 
\begin_inset ERT
status open

\begin_layout Plain Layout


\backslash
lstinline{.solve_hh_ss()}
\end_layout

\end_inset

.
\end_layout

\begin_layout Enumerate
\begin_inset ERT
status open

\begin_layout Plain Layout


\backslash
vspace{-1mm}
\end_layout

\end_inset


\begin_inset ERT
status open

\begin_layout Plain Layout


\backslash
lstinline{.find_ss()}
\end_layout

\end_inset

 (method), which solves for the steady state, i.e.
 fills 
\begin_inset ERT
status open

\begin_layout Plain Layout


\backslash
lstinline{ss}
\end_layout

\end_inset

, and solve and simulate the household problem in steady state (call 
\begin_inset ERT
status open

\begin_layout Plain Layout


\backslash
lstinline{.solve_hh_ss()}
\end_layout

\end_inset

 and 
\begin_inset ERT
status open

\begin_layout Plain Layout


\backslash
lstinline{.simulate_hh_ss()}
\end_layout

\end_inset

, see below).
\end_layout

\begin_layout Standard
Compared to the general model formulation above the code, currently, only
 allows for a structure with the household block and pre- and post-blocks.
 The user must provide the following 
\series bold
jitted
\begin_inset Foot
status collapsed

\begin_layout Plain Layout
The function should be decorated with 
\begin_inset ERT
status open

\begin_layout Plain Layout


\backslash
lstinline{@numba.njit}
\end_layout

\end_inset

.
\end_layout

\end_inset

 functions
\series default
:
\end_layout

\begin_layout Enumerate
\begin_inset ERT
status open

\begin_layout Plain Layout


\backslash
vspace{-1mm}
\end_layout

\end_inset


\series bold
Bellman iteration
\series default
 (function), 
\begin_inset ERT
status open

\begin_layout Plain Layout


\backslash
lstinline{.solve_hh_bakcwards()}
\end_layout

\end_inset

 which iterates one step backwards in the household problem.
 Arguments must by: 
\begin_inset Newline newline
\end_inset


\begin_inset ERT
status open

\begin_layout Plain Layout


\backslash
lstinline{par}
\end_layout

\end_inset

 and 
\begin_inset ERT
status open

\begin_layout Plain Layout


\backslash
lstinline{z_trans}
\end_layout

\end_inset

 (transition matrix in period 
\begin_inset Formula $t$
\end_inset

).
\begin_inset Newline newline
\end_inset

all variables in 
\begin_inset ERT
status open

\begin_layout Plain Layout


\backslash
lstinline{.inputs_hh}
\end_layout

\end_inset

, 
\begin_inset ERT
status open

\begin_layout Plain Layout


\backslash
lstinline{.outputs_hh}
\end_layout

\end_inset

 and 
\begin_inset ERT
status open

\begin_layout Plain Layout


\backslash
lstinline{.intertemps_hh}
\end_layout

\end_inset

.
\begin_inset Newline newline
\end_inset

all variables in 
\begin_inset ERT
status open

\begin_layout Plain Layout


\backslash
lstinline{.intertemps_hh}
\end_layout

\end_inset

 with suffix 
\begin_inset ERT
status open

\begin_layout Plain Layout


\backslash
lstinline{_plus}
\end_layout

\end_inset

.
\end_layout

\begin_layout Enumerate
\begin_inset ERT
status open

\begin_layout Plain Layout


\backslash
vspace{-1mm}
\end_layout

\end_inset


\series bold
Evaluate block before household block
\series default
 (function), 
\begin_inset ERT
status open

\begin_layout Plain Layout


\backslash
lstinline{.block_pre()}
\end_layout

\end_inset

.
 Inputs must be: 
\begin_inset ERT
status open

\begin_layout Plain Layout


\backslash
lstinline{(par,ini,ss,path,ncols)}
\end_layout

\end_inset

, where 
\begin_inset ERT
status open

\begin_layout Plain Layout


\backslash
lstinline{ncols}
\end_layout

\end_inset

 is 
\begin_inset Formula $1$
\end_inset

 or 
\begin_inset ERT
status open

\begin_layout Plain Layout


\backslash
lstinline{len(unknowns)}$
\backslash
times$
\backslash
lstinline{par.T}
\end_layout

\end_inset

, and the latter is used to evaluate the path simultaneously for all one
 step changes.
 After this block has been evaluated all paths in 
\begin_inset ERT
status open

\begin_layout Plain Layout


\backslash
lstinline{.inputs_hh}
\end_layout

\end_inset

 and 
\begin_inset ERT
status open

\begin_layout Plain Layout


\backslash
lstinline{.inputs_hh_z}
\end_layout

\end_inset

 must be filled.
\end_layout

\begin_layout Enumerate
\begin_inset ERT
status open

\begin_layout Plain Layout


\backslash
vspace{-1mm}
\end_layout

\end_inset


\series bold
Evaluate block after household block
\series default
 (function), 
\begin_inset ERT
status open

\begin_layout Plain Layout


\backslash
lstinline{.block_post()}
\end_layout

\end_inset

.
 Same requirements as 
\begin_inset ERT
status open

\begin_layout Plain Layout


\backslash
lstinline{.block_pre()}
\end_layout

\end_inset

.
 Can rely on paths in 
\begin_inset ERT
status open

\begin_layout Plain Layout


\backslash
lstinline{.ouputs_hh}
\end_layout

\end_inset

.
\end_layout

\begin_layout Standard
Additionally, the user can provide a jitted function for calculating a time-vary
ing transition matrix:
\end_layout

\begin_layout Enumerate
\begin_inset ERT
status open

\begin_layout Plain Layout


\backslash
vspace{-1mm}
\end_layout

\end_inset


\series bold
Transition function
\series default
 (function), 
\begin_inset ERT
status open

\begin_layout Plain Layout


\backslash
lstinline{.fill_z_trans()}
\end_layout

\end_inset

 which calculates transition matrix.
 Arguments must be 
\begin_inset ERT
status open

\begin_layout Plain Layout


\backslash
lstinline{par}
\end_layout

\end_inset

, 
\begin_inset ERT
status open

\begin_layout Plain Layout


\backslash
lstinline{z_trans}
\end_layout

\end_inset

 and all elements in 
\begin_inset ERT
status open

\begin_layout Plain Layout


\backslash
lstinline{.inputs_hh_z}
\end_layout

\end_inset

.
\end_layout

\begin_layout Standard
The following internal methods are 
\series bold
now available
\series default
:
\end_layout

\begin_layout Enumerate
\begin_inset ERT
status open

\begin_layout Plain Layout


\backslash
vspace{-1mm}
\end_layout

\end_inset


\begin_inset ERT
status open

\begin_layout Plain Layout


\backslash
lstinline{.solve_hh_ss()}
\end_layout

\end_inset

: Solve household problem in steady state 
\begin_inset Formula $\rightarrow$
\end_inset

 
\begin_inset ERT
status open

\begin_layout Plain Layout


\backslash
lstinline{ss.VARNAME}
\end_layout

\end_inset

.
 
\end_layout

\begin_layout Enumerate
\begin_inset ERT
status open

\begin_layout Plain Layout


\backslash
vspace{-3mm}
\end_layout

\end_inset


\begin_inset ERT
status open

\begin_layout Plain Layout


\backslash
lstinline{.simulate_hh_ss()}
\end_layout

\end_inset

: Simulate household problem in steady state 
\begin_inset Formula $\rightarrow$
\end_inset

 
\begin_inset ERT
status open

\begin_layout Plain Layout


\backslash
lstinline{ss.D}
\end_layout

\end_inset


\begin_inset Newline newline
\end_inset

and 
\begin_inset ERT
status open

\begin_layout Plain Layout


\backslash
lstinline{ss.VARNAME.upper()_hh}
\end_layout

\end_inset

 for all variables in 
\begin_inset ERT
status open

\begin_layout Plain Layout


\backslash
lstinline{.outputs_hh}
\end_layout

\end_inset

.
\end_layout

\begin_layout Enumerate
\begin_inset ERT
status open

\begin_layout Plain Layout


\backslash
vspace{-3mm}
\end_layout

\end_inset


\begin_inset ERT
status open

\begin_layout Plain Layout


\backslash
lstinline{.solve_hh_path()}
\end_layout

\end_inset

: Solve household problem 
\begin_inset Formula $\rightarrow$
\end_inset

 
\begin_inset ERT
status open

\begin_layout Plain Layout


\backslash
lstinline{path.VARNAME}
\end_layout

\end_inset


\end_layout

\begin_layout Enumerate
\begin_inset ERT
status open

\begin_layout Plain Layout


\backslash
vspace{-3mm}
\end_layout

\end_inset


\begin_inset ERT
status open

\begin_layout Plain Layout


\backslash
lstinline{.simulate_hh_path()}
\end_layout

\end_inset

: Simulate household problem 
\begin_inset Formula $\rightarrow$
\end_inset

 
\begin_inset ERT
status open

\begin_layout Plain Layout


\backslash
lstinline{path.D}
\end_layout

\end_inset

 and 
\begin_inset ERT
status open

\begin_layout Plain Layout


\backslash
lstinline{path.VARNAME.upper()_hh}
\end_layout

\end_inset

 for all variables in 
\begin_inset ERT
status open

\begin_layout Plain Layout


\backslash
lstinline{.outputs_hh}
\end_layout

\end_inset

.
\end_layout

\begin_layout Enumerate
\begin_inset ERT
status open

\begin_layout Plain Layout


\backslash
vspace{-3mm}
\end_layout

\end_inset


\begin_inset ERT
status open

\begin_layout Plain Layout


\backslash
lstinline{.compute_jacs(skip_hh=False,skip_shocks=False)}
\end_layout

\end_inset

:
\begin_inset Newline newline
\end_inset

Compute the Jacobians 
\begin_inset Formula $\rightarrow$
\end_inset

 
\begin_inset ERT
status open

\begin_layout Plain Layout


\backslash
lstinline{jac_hh}
\end_layout

\end_inset

, 
\begin_inset ERT
status open

\begin_layout Plain Layout


\backslash
lstinline{H_U}
\end_layout

\end_inset

, 
\begin_inset ERT
status open

\begin_layout Plain Layout


\backslash
lstinline{H_Z}
\end_layout

\end_inset

, and 
\begin_inset ERT
status open

\begin_layout Plain Layout


\backslash
lstinline{jac}
\end_layout

\end_inset

.
\end_layout

\begin_layout Enumerate
\begin_inset ERT
status open

\begin_layout Plain Layout


\backslash
vspace{-3mm}
\end_layout

\end_inset


\begin_inset ERT
status open

\begin_layout Plain Layout


\backslash
lstinline{.find_transition_path()}
\end_layout

\end_inset

: Find transition path 
\begin_inset Formula $\rightarrow$
\end_inset

 
\begin_inset ERT
status open

\begin_layout Plain Layout

 
\backslash
lstinline{path}
\end_layout

\end_inset

.
\end_layout

\begin_layout Enumerate
\begin_inset ERT
status open

\begin_layout Plain Layout


\backslash
vspace{-3mm}
\end_layout

\end_inset


\begin_inset ERT
status open

\begin_layout Plain Layout


\backslash
lstinline{.find_IRFs(reuse_G_U=False)}
\end_layout

\end_inset

: Find linearized impulse-response 
\begin_inset Formula $\rightarrow$
\end_inset

 
\begin_inset ERT
status open

\begin_layout Plain Layout

 
\backslash
lstinline{IRF}[VARNAME]
\end_layout

\end_inset

.
\end_layout

\begin_layout Enumerate
\begin_inset ERT
status open

\begin_layout Plain Layout


\backslash
vspace{-3mm}
\end_layout

\end_inset


\begin_inset ERT
status open

\begin_layout Plain Layout


\backslash
lstinline{.simulate(skip_hh=False,reuse_G_U=False)}
\end_layout

\end_inset

: Simulate model 
\begin_inset Formula $\rightarrow$
\end_inset

 
\begin_inset ERT
status open

\begin_layout Plain Layout

 
\backslash
lstinline{sim.VARNAME}
\end_layout

\end_inset

.
\end_layout

\begin_layout Standard
The default for the 
\emph on
impulses-responses
\emph default
 is to consider AR(1) shocks given by 
\begin_inset ERT
status open

\begin_layout Plain Layout


\backslash
lstinline{par.jump_VARNAME}
\end_layout

\end_inset

 and 
\begin_inset ERT
status open

\begin_layout Plain Layout


\backslash
lstinline{par.rho_VARNAME}
\end_layout

\end_inset

.
 Both solution methods 
\begin_inset ERT
status open

\begin_layout Plain Layout


\backslash
lstinline{.find_transition_path()}
\end_layout

\end_inset

 and 
\begin_inset ERT
status open

\begin_layout Plain Layout


\backslash
lstinline{.find_IRFs_path()}
\end_layout

\end_inset

 also accepts a dictionary like 
\begin_inset ERT
status open

\begin_layout Plain Layout


\backslash
lstinline[mathescape]!shock_specs={dSHOCKE:CUSTOMPATH}!
\end_layout

\end_inset

 as input, where 
\begin_inset ERT
status open

\begin_layout Plain Layout


\backslash
lstinline{CUSTOMPATH}
\end_layout

\end_inset

 is an arbitrary path for the shocks for which to compute the solution.
\end_layout

\begin_layout Standard
The default for the 
\emph on
simulation 
\emph default
is to consider AR(1) shocks given by 
\begin_inset ERT
status open

\begin_layout Plain Layout


\backslash
lstinline{par.std_VARNAME}
\end_layout

\end_inset

 and 
\begin_inset ERT
status open

\begin_layout Plain Layout


\backslash
lstinline{par.rho_VARNAME}
\end_layout

\end_inset

.
 The aggregated household variables also exists in a version with suffix
 
\begin_inset ERT
status open

\begin_layout Plain Layout


\backslash
lstinline{_from_D}
\end_layout

\end_inset

, where the response is calculated by linearizing the policy function and
 then aggregating explicitely.
\end_layout

\begin_layout Standard
\begin_inset Newpage newpage
\end_inset


\end_layout

\begin_layout Standard
\begin_inset ERT
status open

\begin_layout Plain Layout


\backslash
begin{lstlisting}[language=Python,caption=Example: Setup,label=lst:setup,basicst
yle=
\backslash
linespread{1.3}
\backslash
ttfamily
\backslash
footnotesize,
\end_layout

\begin_layout Plain Layout

numbers=left,frame=single,backgroundcolor=
\backslash
color{background}]
\end_layout

\begin_layout Plain Layout

from EconModel import EconModelClass
\end_layout

\begin_layout Plain Layout

from GEModelTools import GEModelClass
\end_layout

\begin_layout Plain Layout

\end_layout

\begin_layout Plain Layout

class MyModelClass(EconModelClass,GEModelClass):
\end_layout

\begin_layout Plain Layout

    
\end_layout

\begin_layout Plain Layout

    def settings(self):
\end_layout

\begin_layout Plain Layout

		
\end_layout

\begin_layout Plain Layout

        self.grids_hh = [] # grids
\end_layout

\begin_layout Plain Layout

        self.pols_hh = [] # policy functions
\end_layout

\begin_layout Plain Layout

        self.inputs_hh = [] # inputs to hh problem, direct
\end_layout

\begin_layout Plain Layout

        self.inputs_hh_z = [] # ...
 inputs to transition matrix
\end_layout

\begin_layout Plain Layout

        self.outputs_hh = [] # output of hh problem 
\end_layout

\begin_layout Plain Layout

        self.intertemps_hh = [] # intertemporal variables in hh problem
\end_layout

\begin_layout Plain Layout

\end_layout

\begin_layout Plain Layout

        self.shocks = [] # exogenous inputs
\end_layout

\begin_layout Plain Layout

        self.unknowns= [] # endogenous inputs
\end_layout

\begin_layout Plain Layout

        self.targets = [] # targets 
\end_layout

\begin_layout Plain Layout

        self.varlist = [] # all variables
\end_layout

\begin_layout Plain Layout

\end_layout

\begin_layout Plain Layout

		self.fill_z_trans = None
\end_layout

\begin_layout Plain Layout

		self.solve_hh_backwards_step = solve_hh_backwards_step
\end_layout

\begin_layout Plain Layout

		self.block_pre = block_pre
\end_layout

\begin_layout Plain Layout

		self.block_post = block_post
\end_layout

\begin_layout Plain Layout

\end_layout

\begin_layout Plain Layout

    def setup(self):
\end_layout

\begin_layout Plain Layout

\end_layout

\begin_layout Plain Layout

        par = self.par
\end_layout

\begin_layout Plain Layout

		par.Nfix = 1 
\end_layout

\begin_layout Plain Layout

		par.Nz = 7
\end_layout

\begin_layout Plain Layout

        par.NVARNAME = 100 # number of grid points
\end_layout

\begin_layout Plain Layout

        par.jump_VARNAME = -0.01 # initial jump
\end_layout

\begin_layout Plain Layout

        par.rho_VARNAME = 0.8 # AR(1) coefficeint
\end_layout

\begin_layout Plain Layout

		par.std_VARNAME = 0.01 # standard deviation
\end_layout

\begin_layout Plain Layout

        par.T = 500 # length of path        
\end_layout

\begin_layout Plain Layout

        par.simT = 1000 # length of simulation
\end_layout

\begin_layout Plain Layout

       
\end_layout

\begin_layout Plain Layout

    def allocate(self):
\end_layout

\begin_layout Plain Layout

\end_layout

\begin_layout Plain Layout

        self.allocate_GE()
\end_layout

\begin_layout Plain Layout

	
\end_layout

\begin_layout Plain Layout

	def prepare_hh_ss(self): pass
\end_layout

\begin_layout Plain Layout

	def find_ss(self): pass
\end_layout

\begin_layout Plain Layout

\end_layout

\begin_layout Plain Layout


\backslash
end{lstlisting}
\end_layout

\end_inset


\end_layout

\begin_layout Standard
\begin_inset Newpage newpage
\end_inset


\end_layout

\begin_layout Section
Efficient computation of the household Jacobian
\begin_inset CommandInset label
LatexCommand label
name "sec:Efficient-computation-of"

\end_inset


\end_layout

\begin_layout Standard
In this section, we explain how the Jacobian of the household block can
 be computed efficiently.
 This algorithm is fully generic, and the package can be used without understand
ing this section in detail.
\end_layout

\begin_layout Standard
The household block can be summarized as
\begin_inset Formula 
\begin{align}
\boldsymbol{Y}^{hh} & =hh(\boldsymbol{X}^{hh}).\label{eq:h}
\end{align}

\end_inset

We are interested in finding the Jacobian around the steady state, i.e.
\begin_inset Formula 
\begin{equation}
\mathcal{J}^{hh}=\frac{dhh(\boldsymbol{X}_{ss}^{hh})}{d\boldsymbol{X}^{hh}}.\label{eq:Jhh}
\end{equation}

\end_inset

We let 
\begin_inset Formula $\mathcal{J}_{t,s}^{hh,o,i}$
\end_inset

 denote the derivative of output 
\begin_inset Formula $o$
\end_inset

 to input 
\begin_inset Formula $i$
\end_inset

 at time 
\begin_inset Formula $t$
\end_inset

 for a shock at time 
\begin_inset Formula $s$
\end_inset

.
\end_layout

\begin_layout Standard
Let 
\begin_inset Formula $\bullet_{t}^{s,i}$
\end_inset

 denote a variable in the equation system 
\begin_inset CommandInset ref
LatexCommand eqref
reference "eq:v_general"
plural "false"
caps "false"
noprefix "false"

\end_inset

-
\begin_inset CommandInset ref
LatexCommand eqref
reference "eq:Y_general"
plural "false"
caps "false"
noprefix "false"

\end_inset

 when all inputs are at their steady state value 
\emph on
except in period 
\begin_inset Formula $s$
\end_inset


\emph default
, where there is an infinitesimal shock 
\begin_inset Formula $dx$
\end_inset

 to input variable 
\begin_inset Formula $i$
\end_inset

.
 We then write
\begin_inset Formula 
\begin{align}
\boldsymbol{\underline{D}}_{t+1}^{s,i} & =\left(\Lambda_{t}^{s,i}\right)^{\prime}\left(\Pi_{t}^{s,i}\right)^{\prime}\boldsymbol{\underline{D}}_{t}^{s,i}\label{eq:D_ubars}\\
\boldsymbol{Y}_{t}^{hh,s,i} & =\left(\boldsymbol{y}_{t}^{s,i}\right)^{\prime}\left(\Pi_{t}^{s,i}\right)^{\prime}\boldsymbol{\underline{D}}_{t}^{s,i}\label{eq:Ys}
\end{align}

\end_inset


\end_layout

\begin_layout Paragraph*
Building blocks.
\end_layout

\begin_layout Standard
The value function equations 
\begin_inset CommandInset ref
LatexCommand eqref
reference "eq:v_general"
plural "false"
caps "false"
noprefix "false"

\end_inset

 and 
\begin_inset CommandInset ref
LatexCommand eqref
reference "eq:v_ubar_general"
plural "false"
caps "false"
noprefix "false"

\end_inset

 are forward looking so 
\begin_inset Formula 
\begin{align*}
\boldsymbol{v}_{t}^{s,i} & =\boldsymbol{v}_{ss}\text{ for }t>s\\
\underline{\boldsymbol{v}}_{t}^{s,i} & =\underline{\boldsymbol{v}}_{ss}\text{ for }t>s
\end{align*}

\end_inset

Additionally, only the time span until the shock arrives matter so 
\begin_inset Formula 
\begin{align*}
\boldsymbol{v}_{t}^{s,i} & =\boldsymbol{v}_{t-1}^{s-1,i}\text{ for }t\leq s\\
\boldsymbol{\underline{v}}_{t}^{s,i} & =\underline{\boldsymbol{v}}_{t-1}^{s-1,i}\text{ for }t\leq s
\end{align*}

\end_inset

This carries over to 
\begin_inset Formula $\boldsymbol{y}_{t}^{s,i}$
\end_inset

 and 
\begin_inset Formula $\Lambda_{t}^{s,i}$
\end_inset

 such that for all 
\begin_inset Formula $t,s\geq0$
\end_inset


\begin_inset Formula 
\begin{equation}
\boldsymbol{y}_{t}^{s,i}=\begin{cases}
\boldsymbol{y}_{ss} & t>s\\
\boldsymbol{y}_{T-1-(s-t)}^{T-1,i} & t\leq s
\end{cases}\,\,\,\text{and}\,\,\,\Lambda_{t}^{s,i}=\begin{cases}
\Lambda_{ss} & t>s\\
\Lambda_{T-1-(s-t)}^{T-1,i} & t\leq s
\end{cases}.\label{eq:timspan_I}
\end{equation}

\end_inset


\end_layout

\begin_layout Standard
We finally have for all 
\begin_inset Formula $t,s\geq0$
\end_inset

 that
\begin_inset Formula 
\begin{equation}
\Pi_{t}^{s,i}=\begin{cases}
\Pi_{ss} & t\neq s\\
\Pi_{T-1,ss}^{T-1,i} & t=s
\end{cases}\label{eq:timespan_II}
\end{equation}

\end_inset


\end_layout

\begin_layout Standard
This implies that 
\begin_inset Formula $\boldsymbol{y}_{t}^{s,i}$
\end_inset

, 
\begin_inset Formula $\Lambda_{t}^{s,i}$
\end_inset

 and 
\begin_inset Formula $\Pi_{t}^{s,i}$
\end_inset

 can all be found for any 
\begin_inset Formula $t$
\end_inset

 and 
\begin_inset Formula $s$
\end_inset

 once 
\begin_inset Formula $\Pi_{T-1,ss}^{T-1,i}$
\end_inset

 is known and 
\begin_inset Formula $\boldsymbol{y}_{t}^{T-1,i}$
\end_inset

 and 
\begin_inset Formula $\Lambda_{t}^{T-1,i}$
\end_inset

 and is known for 
\begin_inset Formula $t\in\{0,1,\dots,T-1\}$
\end_inset

.
 This only requires a single backwards iteration from a shock in period
 
\begin_inset Formula $T-1$
\end_inset

 for each input.
\end_layout

\begin_layout Standard
For later use, we define the following objects:
\begin_inset Formula 
\begin{align*}
\mathcal{Y}_{0,s}^{o,i} & \equiv\frac{dY_{0}^{o,s,i}}{dx}=\frac{\left(d\boldsymbol{y}_{0}^{o,s,i}\right)^{\prime}}{dx}\left(\Pi_{ss}\right)^{\prime}\underline{\boldsymbol{D}}_{ss}+\begin{cases}
\boldsymbol{y}_{ss}^{o}\frac{\left(d\Pi_{0}^{s,i}\right)^{\prime}}{dx}\underline{\boldsymbol{D}}_{ss} & \text{if }s=0\\
0 & \text{else}
\end{cases}\\
\underline{\mathcal{D}}_{1,s}^{i} & \equiv\frac{d\underline{\boldsymbol{D}}_{1}^{s,i}}{dx}=\frac{\left(d\Lambda_{0}^{s,i}\right)^{\prime}}{dx}\left(\Pi_{ss}\right)^{\prime}\underline{\boldsymbol{D}}_{ss}+\begin{cases}
\Lambda_{ss}^{\prime}\frac{\left(d\Pi_{0}^{s,i}\right)^{\prime}}{dx}\underline{\boldsymbol{D}}_{ss} & \text{if }s=0\\
0 & \text{else}
\end{cases}\\
\mathcal{E}_{t}^{o} & \equiv\left(\Pi_{ss}\Lambda_{ss}\right)^{t}\Pi_{ss}\boldsymbol{y}_{ss}^{o},
\end{align*}

\end_inset

where 
\begin_inset Formula $\mathcal{Y}_{0,s}^{o,i}$
\end_inset

 and 
\begin_inset Formula $\underline{\mathcal{D}}_{1,s}^{i}$
\end_inset

 are derivatives of the outputs and the distribution at respectively time
 
\begin_inset Formula $0$
\end_inset

 and time 
\begin_inset Formula $1$
\end_inset

 to a shock at time 
\begin_inset Formula $s$
\end_inset

, and 
\begin_inset Formula $\mathcal{E}_{t}^{o}$
\end_inset

 is an expectation vector.
 The cost of computing 
\begin_inset Formula $\mathcal{Y}_{0,s}^{o,i}$
\end_inset

 and 
\begin_inset Formula $\underline{\mathcal{D}}_{1,s}^{i}$
\end_inset

 for 
\begin_inset Formula $s\in\{0,1,\dots,T-1\}$
\end_inset

 are similar to a full forward simulation for 
\begin_inset Formula $T$
\end_inset

 periods.
 The cost of computing 
\begin_inset Formula $\mathcal{E}_{s}^{o}$
\end_inset

 is negligible in comparison and can be done recursively, 
\begin_inset Formula $\mathcal{E}_{t}^{o}=\Pi_{ss}\Lambda_{ss}\mathcal{E}_{t-1}^{o}$
\end_inset

 with 
\begin_inset Formula $\mathcal{E}_{0}^{o}=\Pi_{ss}\boldsymbol{y}_{ss}^{o}$
\end_inset

.
 
\end_layout

\begin_layout Standard

\emph on
The task is to build the full Jacobian from these building blocks
\emph default
.
 To do this, we first need to take the total derivative of 
\begin_inset CommandInset ref
LatexCommand eqref
reference "eq:D_ubars"
plural "false"
caps "false"
noprefix "false"

\end_inset

 and 
\begin_inset CommandInset ref
LatexCommand eqref
reference "eq:Ys"
plural "false"
caps "false"
noprefix "false"

\end_inset

 around the steady state
\end_layout

\begin_layout Standard
\begin_inset Formula 
\begin{align}
d\boldsymbol{\underline{D}}_{t+1}^{s,i} & =\Lambda_{ss}^{\prime}\Pi_{ss}^{\prime}d\boldsymbol{\underline{D}}_{t}^{s,i}+(d\Lambda_{t}^{s,i})^{\prime}\Pi_{ss}^{\prime}\boldsymbol{\underline{D}}_{ss}+\Lambda_{ss}d\Pi_{t}^{s,i}\boldsymbol{\underline{D}}_{ss}\label{eq:dD_ubars}\\
dY_{t}^{o,s,i} & =\left(\boldsymbol{y}_{ss}^{o}\right)^{\prime}\Pi_{ss}^{\prime}d\underline{\boldsymbol{D}}_{t}^{s,i}+(d\boldsymbol{y}_{t}^{o,s,i})^{\prime}\Pi_{ss}^{\prime}\boldsymbol{D}_{ss}+(\boldsymbol{y}_{ss}^{o})^{\prime}\left(d\Pi_{t}^{s,i}\right)^{\prime}\boldsymbol{\underline{D}}_{ss}\label{eq:dYs}
\end{align}

\end_inset


\end_layout

\begin_layout Paragraph*
Edge of the Jacobian
\end_layout

\begin_layout Standard
First consider the effect on output at time 
\begin_inset Formula $0$
\end_inset

 from a shock at time 
\begin_inset Formula $s$
\end_inset

.
 We immediately have
\begin_inset Formula 
\begin{equation}
\mathcal{J}_{0,s}^{hh,i,o}=\frac{d\boldsymbol{Y}_{0}^{o,s,i}}{dx}=\mathcal{Y}_{s}^{o,i}\label{eq:Jhh_t0_s}
\end{equation}

\end_inset


\end_layout

\begin_layout Standard

\series medium
Next consider the effect on output at time 
\begin_inset Formula $t\geq1$
\end_inset

 form a shock at time 
\begin_inset Formula $0$
\end_inset

.
 
\series default
Combining equation 
\begin_inset CommandInset ref
LatexCommand eqref
reference "eq:dD_ubars"
plural "false"
caps "false"
noprefix "false"

\end_inset

 with only the time span mattering in equations 
\begin_inset CommandInset ref
LatexCommand eqref
reference "eq:timspan_I"
plural "false"
caps "false"
noprefix "false"

\end_inset

-
\begin_inset CommandInset ref
LatexCommand eqref
reference "eq:timespan_II"
plural "false"
caps "false"
noprefix "false"

\end_inset

 implies for 
\begin_inset Formula $t\geq2$
\end_inset


\series medium

\begin_inset Formula 
\begin{align}
d\underline{\boldsymbol{D}}_{t}^{0,i} & =\Lambda_{ss}^{\prime}\Pi_{ss}^{\prime}d\boldsymbol{\underline{D}}_{t-1}^{0,i}+\underset{=0}{\underbrace{\left(d\Lambda_{t-1}^{0,i}\right)^{\prime}}}\Pi_{ss}^{\prime}\boldsymbol{\underline{D}}_{ss}+\Lambda_{ss}^{\prime}\underset{=0}{\underbrace{\left(d\Pi_{t}^{0,i}\right)^{\prime}}}\boldsymbol{\underline{D}}_{ss}\label{eq:diff_D_ubars_edge}\\
 & =\Lambda_{ss}^{\prime}\Pi_{ss}^{\prime}d\boldsymbol{\underline{D}}_{t-1}^{0,i}\nonumber \\
 & \vdots\nonumber \\
 & =\left(\Lambda_{ss}^{\prime}\Pi_{ss}^{\prime}\right)^{t-1}d\underline{\boldsymbol{D}}_{1}^{0,i}.\nonumber 
\end{align}

\end_inset


\series default
Combining 
\begin_inset CommandInset ref
LatexCommand eqref
reference "eq:dYs"
plural "false"
caps "false"
noprefix "false"

\end_inset

 with only the time span mattering in equation 
\begin_inset CommandInset ref
LatexCommand eqref
reference "eq:timspan_I"
plural "false"
caps "false"
noprefix "false"

\end_inset

-
\begin_inset CommandInset ref
LatexCommand eqref
reference "eq:timespan_II"
plural "false"
caps "false"
noprefix "false"

\end_inset

 , and the above equation 
\begin_inset CommandInset ref
LatexCommand eqref
reference "eq:diff_dDs"
plural "false"
caps "false"
noprefix "false"

\end_inset

 implies for 
\begin_inset Formula $t\geq1$
\end_inset

,
\series medium
 
\begin_inset Formula 
\begin{align}
dY_{t}^{o,0,i} & =\left(\boldsymbol{y}_{ss}^{o}\right)^{\prime}\Pi_{ss}^{\prime}d\underline{\boldsymbol{D}}_{t}^{0,i}+\underset{=0}{\underbrace{\left(d\boldsymbol{y}_{t}^{o,0,i}\right)^{\prime}}}\boldsymbol{\underline{D}}_{ss}+\Lambda_{ss}^{\prime}\underset{=0}{\underbrace{\left(d\Pi_{t}^{0,i}\right)^{\prime}}}\boldsymbol{\underline{D}}_{ss}.\label{eq:diff_Ys_edge}\\
 & =\left(\boldsymbol{y}_{ss}^{o}\right)^{\prime}\Pi_{ss}^{\prime}d\underline{\boldsymbol{D}}_{t}^{0,i}\nonumber \\
 & =\left(\boldsymbol{y}_{ss}^{o}\right)^{\prime}\Pi_{ss}^{\prime}\left(\Lambda_{ss}^{\prime}\Pi_{ss}^{\prime}\right)^{t-1}d\underline{\boldsymbol{D}}_{1}^{0,i}\nonumber 
\end{align}

\end_inset


\series default
Combining equation 
\begin_inset CommandInset ref
LatexCommand eqref
reference "eq:diff_D_ubars_edge"
plural "false"
caps "false"
noprefix "false"

\end_inset

 and 
\begin_inset CommandInset ref
LatexCommand eqref
reference "eq:diff_Ys_edge"
plural "false"
caps "false"
noprefix "false"

\end_inset

 implies for 
\begin_inset Formula $t\geq1$
\end_inset


\begin_inset Formula 
\begin{align}
\mathcal{J}_{t,0}^{hh,i,o} & =\frac{dY_{t}^{o,0,i}}{dx}=\left(\mathcal{E}_{t-1}^{o}\right)^{\prime}\mathcal{\underline{D}}_{0}^{i}\label{eq:Jhh_t_s0}
\end{align}

\end_inset


\end_layout

\begin_layout Paragraph*
Inner parts of the Jacobian.
\end_layout

\begin_layout Standard
Combining 
\begin_inset CommandInset ref
LatexCommand eqref
reference "eq:dD_ubars"
plural "false"
caps "false"
noprefix "false"

\end_inset

 with only the time span mattering in equations 
\begin_inset CommandInset ref
LatexCommand eqref
reference "eq:timspan_I"
plural "false"
caps "false"
noprefix "false"

\end_inset

-
\begin_inset CommandInset ref
LatexCommand eqref
reference "eq:timespan_II"
plural "false"
caps "false"
noprefix "false"

\end_inset

, implies for 
\begin_inset Formula $t,s\geq1$
\end_inset


\end_layout

\begin_layout Standard
\begin_inset Formula 
\begin{align}
d\boldsymbol{\underline{D}}_{t}^{s,i}-d\boldsymbol{\underline{D}}_{t-1}^{s-1,i} & =\Lambda_{ss}^{\prime}\Pi_{ss}^{\prime}\left(d\boldsymbol{\underline{D}}_{t-1}^{s,i}-d\boldsymbol{\underline{D}}_{t-2}^{s-1,i}\right)+\underset{=0}{\underbrace{\left(d\Lambda_{t-1}^{s,i}-d\Lambda_{t-2}^{s-1,i}\right)^{\prime}}}\Pi_{ss}^{\prime}\boldsymbol{D}_{ss}+\Lambda_{ss}^{\prime}\underset{=0}{\underbrace{\left(d\Pi_{t-1}^{s,i}-d\Pi_{t-2}^{s-1,i}\right)^{\prime}}}\boldsymbol{\underline{D}}_{ss}\nonumber \\
 & =\Lambda_{ss}^{\prime}\Pi_{ss}^{\prime}\left(d\boldsymbol{\underline{D}}_{t}^{s,i}-d\boldsymbol{\underline{D}}_{t-1}^{s-1,i}\right)\nonumber \\
 & \vdots\nonumber \\
 & =\left(\Lambda_{ss}^{\prime}\Pi_{ss}^{\prime}\right)^{t-1}\left(d\boldsymbol{\underline{D}}_{1}^{s,i}-\underset{=0}{\underbrace{d\boldsymbol{\underline{D}}_{0}^{s-1,i}}}\right)\nonumber \\
 & =\left(\Lambda_{ss}^{\prime}\Pi_{ss}^{\prime}\right)^{t-1}d\boldsymbol{\underline{D}}_{1}^{s,i}\label{eq:diff_dDs}
\end{align}

\end_inset

where 
\begin_inset Formula $\boldsymbol{\underline{D}}_{0}=\boldsymbol{\underline{D}}_{ss}$
\end_inset

 implies 
\begin_inset Formula $d\boldsymbol{\underline{D}}_{0}^{s-1,i}=0$
\end_inset

 in the next to last line.
\end_layout

\begin_layout Standard
Combining 
\begin_inset CommandInset ref
LatexCommand eqref
reference "eq:dYs"
plural "false"
caps "false"
noprefix "false"

\end_inset

 with only the time span mattering in equation 
\begin_inset CommandInset ref
LatexCommand eqref
reference "eq:timspan_I"
plural "false"
caps "false"
noprefix "false"

\end_inset

-
\begin_inset CommandInset ref
LatexCommand eqref
reference "eq:timespan_II"
plural "false"
caps "false"
noprefix "false"

\end_inset

 , and the above equation 
\begin_inset CommandInset ref
LatexCommand eqref
reference "eq:diff_dDs"
plural "false"
caps "false"
noprefix "false"

\end_inset

, implies for 
\begin_inset Formula $t,s\geq1$
\end_inset


\end_layout

\begin_layout Standard
\begin_inset Formula 
\begin{align}
dY_{t}^{o,s,i}-dY_{t-1}^{o,s-1,i} & =(\boldsymbol{y}_{ss}^{o})^{\prime}\Pi_{ss}^{\prime}\left(d\boldsymbol{\underline{D}}_{t}^{s,i}-d\boldsymbol{\underline{D}}_{t-1}^{s-1,i}\right)+\underset{=0}{\underbrace{\left(d\boldsymbol{y}_{t}^{o,s,i}-d\boldsymbol{y}_{t-1}^{o,s-1,i}\right)^{\prime}}}\Pi_{ss}^{\prime}\boldsymbol{D}_{ss}+\boldsymbol{y}_{ss}^{o}\underset{=0}{\underbrace{\left(d\Pi_{t}^{s,i}-d\Pi_{t-1}^{s-1,i}\right)^{\prime}}}\boldsymbol{\underline{D}}_{ss}\label{eq:diff_dYs}\\
 & =(\boldsymbol{y}_{ss}^{o})^{\prime}\Pi_{ss}^{\prime}\left(d\boldsymbol{\underline{D}}_{t}^{s,i}-d\underline{\boldsymbol{D}}_{t-1}^{s-1,i}\right)\nonumber \\
 & =(\boldsymbol{y}_{ss}^{o})^{\prime}\Pi_{ss}^{\prime}\left(\Lambda_{ss}^{\prime}\Pi_{ss}^{\prime}\right)^{t-1}d\boldsymbol{\underline{D}}_{1}^{s,i}\nonumber \\
 & =\left(\mathcal{E}_{t-1}^{o}\right)^{\prime}d\boldsymbol{\underline{D}}_{1}^{s,i}\nonumber 
\end{align}

\end_inset

Combining 
\begin_inset CommandInset ref
LatexCommand eqref
reference "eq:diff_dDs"
plural "false"
caps "false"
noprefix "false"

\end_inset

 and 
\begin_inset CommandInset ref
LatexCommand eqref
reference "eq:diff_dYs"
plural "false"
caps "false"
noprefix "false"

\end_inset

 for 
\begin_inset Formula $t,s\geq1$
\end_inset

 implies 
\begin_inset Formula 
\begin{align}
\mathcal{J}_{t,s}^{hh,i,o}-\mathcal{J}_{t-1,s-1}^{hh,i,o} & =\frac{dY_{t}^{o,s,i}-dY_{t-1}^{o,s-1,i}}{dx}\Leftrightarrow\nonumber \\
\mathcal{J}_{t,s}^{hh,i,o} & =\mathcal{J}_{t-1,s-1}^{hh,i,o}+\left(\mathcal{E}_{t-1}^{o}\right)^{\prime}\underline{\mathcal{D}}_{s}^{i}\label{eq:Jhh_inner}
\end{align}

\end_inset


\end_layout

\begin_layout Paragraph*
Recursive formulation
\end_layout

\begin_layout Standard
Define the object
\end_layout

\begin_layout Standard
\begin_inset Formula 
\begin{equation}
\mathcal{F}_{t,s}^{,i,o}\equiv\begin{cases}
\mathcal{Y}_{s}^{o,i} & t=0\\
\left(\mathcal{E}_{t-1}^{o}\right)^{\prime}\underline{\mathcal{D}}_{s}^{i} & t\geq1
\end{cases}\label{eq:F}
\end{equation}

\end_inset

Combining equations 
\begin_inset CommandInset ref
LatexCommand eqref
reference "eq:Jhh_t0_s"
plural "false"
caps "false"
noprefix "false"

\end_inset

, 
\begin_inset CommandInset ref
LatexCommand eqref
reference "eq:Jhh_t_s0"
plural "false"
caps "false"
noprefix "false"

\end_inset

 and 
\begin_inset CommandInset ref
LatexCommand eqref
reference "eq:Jhh_inner"
plural "false"
caps "false"
noprefix "false"

\end_inset

, the household Jacobian can be written recursively by
\begin_inset Formula 
\begin{equation}
\mathcal{J}_{t,s}^{i,o}=\sum_{k=0}^{\min\{t,s\}}\mathcal{F}_{t-k,s-k}^{i,o}\label{eq:Jhh_recursive}
\end{equation}

\end_inset


\end_layout

\begin_layout Section
Additional features
\begin_inset CommandInset label
LatexCommand label
name "sec:Additional-features"

\end_inset


\end_layout

\begin_layout Standard
The following methods are available:
\end_layout

\begin_layout Enumerate
\begin_inset ERT
status open

\begin_layout Plain Layout


\backslash
vspace{-1mm}
\end_layout

\end_inset


\begin_inset ERT
status open

\begin_layout Plain Layout


\backslash
lstinline{.show_IRFS((...)}
\end_layout

\end_inset


\begin_inset Newline newline
\end_inset

Show IRFs.
\end_layout

\begin_layout Enumerate
\begin_inset ERT
status open

\begin_layout Plain Layout


\backslash
vspace{-1mm}
\end_layout

\end_inset


\begin_inset ERT
status open

\begin_layout Plain Layout


\backslash
lstinline{.compare_IRFS(...)}
\end_layout

\end_inset


\begin_inset Newline newline
\end_inset

Compare IRFs across models.
\end_layout

\begin_layout Enumerate
\begin_inset ERT
status open

\begin_layout Plain Layout


\backslash
vspace{-1mm}
\end_layout

\end_inset


\begin_inset ERT
status open

\begin_layout Plain Layout


\backslash
lstinline{.decompose_hh_path(...)}
\end_layout

\end_inset


\begin_inset Newline newline
\end_inset

Decompose household transition path (varying inputs and initial distribution)
\end_layout

\begin_layout Enumerate
\begin_inset ERT
status open

\begin_layout Plain Layout


\backslash
vspace{-1mm}
\end_layout

\end_inset


\begin_inset ERT
status open

\begin_layout Plain Layout


\backslash
lstinline{.print_unpack_varlist(...)}
\end_layout

\end_inset

:
\begin_inset Newline newline
\end_inset

Print unpacking of all variables for use in 
\begin_inset ERT
status open

\begin_layout Plain Layout


\backslash
lstinline{.block_pre(...)}
\end_layout

\end_inset

 and 
\begin_inset ERT
status open

\begin_layout Plain Layout


\backslash
lstinline{.block_post(...)}
\end_layout

\end_inset

.
\end_layout

\begin_layout Enumerate
\begin_inset ERT
status open

\begin_layout Plain Layout


\backslash
vspace{-1mm}
\end_layout

\end_inset


\begin_inset ERT
status open

\begin_layout Plain Layout


\backslash
lstinline{.test_hh_z_path(...)}
\end_layout

\end_inset

:
\begin_inset Newline newline
\end_inset

Test time-invariance when inputs are at their steady state values.
\end_layout

\begin_layout Enumerate
\begin_inset ERT
status open

\begin_layout Plain Layout


\backslash
vspace{-1mm}
\end_layout

\end_inset


\begin_inset ERT
status open

\begin_layout Plain Layout


\backslash
lstinline{.test_hh_path(...)}
\end_layout

\end_inset

:
\begin_inset Newline newline
\end_inset

Test time-invariance when inputs are at their steady state values.
\end_layout

\begin_layout Enumerate
\begin_inset ERT
status open

\begin_layout Plain Layout


\backslash
vspace{-1mm}
\end_layout

\end_inset


\begin_inset ERT
status open

\begin_layout Plain Layout


\backslash
lstinline{.test_jacs(...)}
\end_layout

\end_inset

:
\begin_inset Newline newline
\end_inset

Compare Jacobians calculated with a direct and the fake news algorithm.
\end_layout

\begin_layout Enumerate
\begin_inset ERT
status open

\begin_layout Plain Layout


\backslash
vspace{-1mm}
\end_layout

\end_inset


\begin_inset ERT
status open

\begin_layout Plain Layout


\backslash
lstinline{.test_path(...)}
\end_layout

\end_inset

:
\begin_inset Newline newline
\end_inset

Test time-invariance when inputs are at their steady state values.
\end_layout

\begin_layout Standard
\begin_inset Newpage newpage
\end_inset


\end_layout

\begin_layout Section
Troubleshooting
\begin_inset CommandInset label
LatexCommand label
name "sec:Troubleshooting"

\end_inset


\end_layout

\begin_layout Standard

\series bold
The transition path cannot be found.

\series default
 Considering the following
\end_layout

\begin_layout Enumerate
Use finer tolerances for finding the steady state
\begin_inset Newline newline
\end_inset


\begin_inset ERT
status open

\begin_layout Plain Layout


\backslash
lstinline{par.tol_solve}
\backslash
,$
\backslash
downarrow$
\end_layout

\end_inset


\begin_inset Newline newline
\end_inset


\begin_inset ERT
status open

\begin_layout Plain Layout


\backslash
lstinline{par.tol_simulate}
\backslash
,$
\backslash
downarrow$
\end_layout

\end_inset


\end_layout

\begin_layout Enumerate
Extend the transition period
\begin_inset Newline newline
\end_inset


\begin_inset ERT
status open

\begin_layout Plain Layout


\backslash
lstinline{par.T}$
\backslash
,
\backslash
uparrow$
\end_layout

\end_inset


\end_layout

\begin_layout Enumerate
Decrease the size and persistence of the size
\begin_inset Newline newline
\end_inset


\begin_inset ERT
status open

\begin_layout Plain Layout


\backslash
lstinline{par.jump_VARNAME}
\backslash
,$
\backslash
downarrow$
\end_layout

\end_inset


\begin_inset Newline newline
\end_inset


\begin_inset ERT
status open

\begin_layout Plain Layout


\backslash
lstinline{par.rho_VARNAME}
\backslash
,$
\backslash
downarrow$
\end_layout

\end_inset


\end_layout

\begin_layout Enumerate
Change other parameters making the model more stable
\begin_inset Newline newline
\end_inset

(e.g.
 more strict Taylor rule, less sticky prices/wages)
\end_layout

\begin_layout Standard
\begin_inset Newpage newpage
\end_inset


\end_layout

\begin_layout Standard
\begin_inset CommandInset bibtex
LatexCommand bibtex
btprint "btPrintCited"
bibfiles "GEModelToolsNotebooks"
options "apalike"

\end_inset


\begin_inset Newpage newpage
\end_inset


\end_layout

\begin_layout Section
\start_of_appendix
HANK model with endogenous idiosyncratic risk
\begin_inset CommandInset label
LatexCommand label
name "sec:HANK-model-with-endo-risk"

\end_inset


\end_layout

\begin_layout Paragraph*
Households
\end_layout

\begin_layout Standard
The real interest rate and the after-tax wage income as employed are now
 denoted 
\begin_inset Formula $r_{t}$
\end_inset

 and 
\begin_inset Formula $w_{t}^{h}$
\end_inset

.
 We additionally assume the households are members of a union, which determines
 its labor supply, and pays out wages and unemployment benefits.
 Finally, households are now assumed to have ex ante heterogeneous discount
 factors, 
\begin_inset Formula $\beta_{i}$
\end_inset

.
\end_layout

\begin_layout Standard
The Bellman equation for the household problem is
\begin_inset Formula 
\begin{align}
v_{t}\left(\beta_{i},u_{t},e_{t},a_{t-1}\right) & =\max_{c_{t},a_{t}\geq0}\frac{c_{t}^{1-\rho}}{1-\rho}+\beta_{i}\mathbb{E}_{t}\left[v_{t+1}\left(\beta_{i},u_{t+1},e_{t+1},a_{t}\right)\right]\label{eq:Bellman_stylized_GE}\\
 & \text{s.t.}\nonumber \\
c_{t}+a_{t} & =(1+r_{t})a_{t-1}+\phi^{u_{t}}w_{t}^{h}e_{t}\nonumber \\
\log e_{t} & =\rho_{e}\log e_{t-1}+\psi_{t}\,\,\,,\psi_{t}\sim\mathcal{N}(\mu_{\psi},\sigma_{\psi}),\,\mathbb{E}[e_{t}]=1\,\nonumber \\
\text{Pr[}u_{t+1}=1\,|\,u_{t}=0] & =\pi_{t+1}^{EU}\nonumber \\
\text{Pr[}u_{t+1}=0\,|\,u_{t}=1] & =\pi_{t+1}^{UE}\nonumber \\
a_{t} & \geq0.\nonumber 
\end{align}

\end_inset

We have 
\begin_inset Formula $z_{t}=(u_{t},e_{t})$
\end_inset

.
 From a perfect foresight sequence space perspective, the value function
 can be written
\begin_inset Formula 
\[
v_{t}\left(u_{t},e_{t},a_{t-1}\right)=v\left(u_{t},e_{t},a_{t-1};\{r_{\tau}^{h},w_{\tau}^{h},\pi_{t}^{EU},\pi_{t}^{UE}\}_{\tau=t}^{\infty}\right).
\]

\end_inset

The average discount factor is 
\begin_inset Formula $\overline{\beta}=\int\beta_{i}\boldsymbol{D}_{t}$
\end_inset

.
\end_layout

\begin_layout Paragraph*
Firms
\end_layout

\begin_layout Standard
The firm 
\begin_inset Formula $j$
\end_inset

 has the production function 
\begin_inset Formula $y_{jt}=Z_{t}n_{jt}$
\end_inset

.
 Price setting frictions with Rotemberg adjustment implies a standard New
 Keynesian Phillips Curve (NKPC),
\begin_inset Formula 
\begin{equation}
(1-\epsilon)+\epsilon w_{t}/Z_{t}=\theta\left(\Pi_{t}-1\right)\Pi_{t}-\overline{\beta}\theta\left(\Pi_{t+1}-1\right)\Pi_{t+1}\frac{Y_{t+1}}{Y_{t}}.\label{eq:NKPC}
\end{equation}

\end_inset

Adjustment costs are considered virtual, and dividends are given by
\begin_inset Formula 
\begin{equation}
d_{t}=Y_{t}-w_{t}N_{t}.\label{eq:d}
\end{equation}

\end_inset

The dividends are fully taxed away by the government.
\end_layout

\begin_layout Paragraph*
Unions
\end_layout

\begin_layout Standard
The unions face wage setting costs giving rise to a New Keynesian Wage Phillips
 Curve (WPC)
\begin_inset Formula 
\[
\left(1-\epsilon_{w}\right)(1-\tau_{t})w_{t}+\epsilon_{w}\frac{v'\left(N_{t}\right)}{u'\left(C_{t}\right)}=\theta_{w}\left(\Pi_{t}^{w}-\bar{\Pi}^{w}\right)\Pi_{t}^{w}-\overline{\beta}\theta_{w}\left(\Pi_{t+1}^{w}-\bar{\Pi}^{w}\right)\Pi_{t+1}^{w}\frac{N_{t+1}}{N_{t}},
\]

\end_inset

where 
\begin_inset Formula $v'(N_{t})=\vartheta N_{t}^{\frac{1}{\varphi}}$
\end_inset

 is an ad hoc marginal disutility of aggregate labor, 
\begin_inset Formula $u^{\prime}(C_{t})$
\end_inset

 is an ad hoc marginal utility of aggregate consumption, 
\begin_inset Formula $C_{t}^{-\rho}$
\end_inset

, 
\begin_inset Formula $\Pi_{t}^{w}=W_{t}/W_{t-1}$
\end_inset

 and 
\begin_inset Formula $W_{t}$
\end_inset

 is the nominal wage.
 The real wage thus is 
\begin_inset Formula $w_{t}=W_{t}/P_{t}$
\end_inset

.
 The adjustment costs are again considered virtual.
\end_layout

\begin_layout Standard
We assume an ad hoc processes for unemployment, 
\begin_inset Formula $U_{t}$
\end_inset

, and the job-finding rate implying the separation rate as a residual,
\begin_inset Formula 
\begin{align}
U_{t} & =U_{ss}(N_{t}/N_{ss})^{\varepsilon_{U}}\label{eq:U}\\
\pi_{t}^{UE} & =\pi_{ss}^{UE}(N_{t}/N_{ss})^{\varepsilon_{UE}}\label{eq:EU}\\
\pi_{t}^{EU} & =\frac{U_{t}-\pi_{t}^{UE}U_{t-1}}{1-U_{t-1}}.\label{eq:UE}
\end{align}

\end_inset

Total after-tax wage income received by the union is 
\begin_inset Formula $(1-\tau_{t})w_{t}N_{t}$
\end_inset

.
 For a given unemployment replacement rate, 
\begin_inset Formula $\phi$
\end_inset

, this implies that the wage rate per productivity unit faced by the households
 are
\begin_inset Formula 
\begin{equation}
w_{t}^{h}=\frac{(1-\tau_{t})w_{t}N_{t}}{\phi U_{t}+(1-U_{t})}.\label{eq:wh}
\end{equation}

\end_inset


\end_layout

\begin_layout Paragraph*
Government
\end_layout

\begin_layout Standard
The government budget identity in real terms is
\begin_inset Formula 
\[
B_{t}=(1+r_{t}+(d_{t}-d_{ss})/B_{t-1})B_{t-1}+G_{t}-\tau_{t}w_{t}N_{t}-d_{t},
\]

\end_inset

where 
\begin_inset Formula $B_{t}$
\end_inset

 is government bonds, 
\begin_inset Formula $G_{t}$
\end_inset

 is government consumption, and 
\begin_inset Formula $\tau_{t}w_{t}N_{t}$
\end_inset

 are total labor taxes.
\end_layout

\begin_layout Standard
We assume government debt, 
\begin_inset Formula $B_{t}$
\end_inset

, initially takes the adjustment when fiscal policy, 
\begin_inset Formula $G_{t}$
\end_inset

, is changed.
 After period 
\begin_inset Formula $t_{B}$
\end_inset

 taxes begin to adjust smoothly over 
\begin_inset Formula $\Delta_{B}$
\end_inset

 periods,
\begin_inset Formula 
\begin{align}
\tau_{t} & =\begin{cases}
\tau_{ss} & \text{if }t<t_{B}\\
(1-\omega(\tilde{t}))\tau_{ss}+\omega(\tilde{t})\tilde{\tau}_{t} & \text{if }t\in[t_{B},t_{B}+\Delta_{B}],\,\tilde{t}=(t-t_{B})/\Delta_{B}\\
\tilde{\tau}_{t} & \text{if }t>t_{B}+\Delta_{B},
\end{cases}\label{eq:taxes}
\end{align}

\end_inset

with
\begin_inset Formula 
\begin{align*}
\tilde{\tau}_{t} & =\tau_{ss}(B_{t-1}/B_{ss})^{\varepsilon_{B}}\\
\omega(x) & =3x^{2}-2x^{3}\,\,\,(\text{smooth \emph{S} function) }
\end{align*}

\end_inset


\end_layout

\begin_layout Paragraph*

\series bold
Monetary Policy
\end_layout

\begin_layout Standard
Monetary policy is set a according to a Taylor Rule,
\series bold

\begin_inset Formula 
\begin{equation}
i_{t}=(1+r_{ss})\Pi_{t}^{\varepsilon_{\pi}}-1.\label{eq:Taylor}
\end{equation}

\end_inset


\series default
The Fisher equation implies
\begin_inset Formula 
\begin{equation}
r_{t}=\frac{1+i_{t-1}}{\Pi_{t}}-1.\label{eq:Fisher}
\end{equation}

\end_inset


\end_layout

\begin_layout Paragraph*

\series bold
Market clearing
\end_layout

\begin_layout Standard
The labor market clears per construction.
 The goods market clearing condition is
\begin_inset Formula 
\begin{equation}
Y_{t}=G_{t}+C_{t}.\label{eq:GoodsClearing}
\end{equation}

\end_inset


\end_layout

\begin_layout Standard
The asset market clearing condition is
\begin_inset Formula 
\begin{equation}
A_{t}=B_{t}.\label{eq:AssetClearing}
\end{equation}

\end_inset


\end_layout

\begin_layout Paragraph*

\series bold
Equation system
\end_layout

\begin_layout Standard
In terms of the general formulation above, we can write the model in terms
 of
\end_layout

\begin_layout Enumerate
Shocks: 
\begin_inset Formula $\boldsymbol{Z}=\{\boldsymbol{\Gamma},\boldsymbol{G}\}$
\end_inset


\end_layout

\begin_layout Enumerate
Unknowns: 
\begin_inset Formula $\boldsymbol{U}=\{\boldsymbol{Y},\boldsymbol{w}\}$
\end_inset


\end_layout

\begin_layout Enumerate
Targets: WPC and goods market clearing
\end_layout

\begin_layout Standard
In sequence space, the model can be summarized as the equation system, 
\size footnotesize

\begin_inset Formula 
\begin{align*}
\boldsymbol{H}(\{Y_{t},w_{t},\Gamma_{t},G_{t}\}_{t=0}^{T}) & =\boldsymbol{0}\Leftrightarrow\\
\left[\begin{array}{c}
\text{WPC}\\
\text{Goods market clearing}
\end{array}\right] & =\boldsymbol{0}\\
\left[\begin{array}{c}
\\
\left(1-\epsilon_{w}\right)(1-\tau_{t})w_{t}+\epsilon_{w}\frac{\vartheta N_{t}^{\frac{1}{\varphi}}}{C_{t}^{-\rho}}-\left[\theta_{w}\left(\Pi_{t}^{w}-\bar{\Pi}^{w}\right)\Pi_{t}^{w}-\overline{\beta}\theta_{w}\left(\Pi_{t+1}^{w}-\bar{\Pi}^{w}\right)\Pi_{t+1}^{w}\frac{N_{t+1}}{N_{t}}\right]\\
Y_{t}=G_{t}+C_{t}
\end{array}\right] & =\left[\begin{array}{c}
\\
0
\end{array}\right]\\
\forall t\in\{0,1,\dots,T-1\}
\end{align*}

\end_inset


\size default
where we solve the NKPC backwards 
\begin_inset Formula $t\in\{T-1,T-2,\dots,0\}$
\end_inset

 for 
\begin_inset Formula $\Pi_{t}$
\end_inset

 
\begin_inset Formula 
\[
(1-\epsilon)+\epsilon w_{t}/\Gamma_{t}-\left[\theta\left(\Pi_{t}-1\right)\Pi_{t}-\overline{\beta}\left(\theta\left(\Pi_{t+1}-1\right)\Pi_{t+1}\frac{Y_{t+1}}{Y_{t}}\right)\right]
\]

\end_inset

and we implicitly have,
\begin_inset Formula 
\begin{align*}
\Pi_{t}^{w} & =w_{t}/w_{t-1}\Pi_{t}\\
w_{t} & =W_{t}/P_{t}\\
i_{t} & =(1+r_{ss})\Pi_{t}^{\varepsilon_{\pi}}\\
r_{t} & =(1+i_{t-1})/\Pi_{t}-1\\
N_{t} & =Y_{t}/\Gamma_{t}\\
d_{t} & =Y_{t}-w_{t}N_{t}\\
U_{t} & =U_{ss}(N_{t}/N_{ss})^{\varepsilon_{U}}\\
\pi_{t}^{UE} & =\pi_{ss}^{UE}(N_{t}/N_{ss})^{\varepsilon_{UE}}\\
\pi_{t}^{EU} & =\frac{U_{t}-\pi_{t}^{UE}U_{t-1}}{1-U_{t-1}}\\
B_{t} & =(1+r_{t})B_{t-1}+G_{t}-\tau_{t}w_{t}N_{t}-d_{t}\\
\tau_{t} & =\begin{cases}
\tau_{ss} & \text{if }t<t_{B}\\
(1-\omega(\tilde{t}))\tau_{ss}+\omega(\tilde{t})\tilde{\tau}_{t} & \text{if }t\in[t_{B},t_{B}+\Delta_{B}],\,\tilde{t}=(t-t_{B})/\Delta_{B}\\
\tilde{\tau}_{t} & \text{if }t>t_{B}+\Delta_{B},
\end{cases}\\
 & \,\,\,\tilde{\tau}_{t}=\tau_{ss}(B_{t}/B_{ss})^{\varepsilon_{B}}\\
 & \,\,\,\omega(x)=3x^{2}-2x^{3}\\
w_{t}^{h} & =\frac{(1-\tau_{t})w_{t}N_{t}}{\phi U_{t}+(1-U_{t})}\\
A_{t} & =B_{t}\\
C_{t} & =Y_{t}-G_{t}\\
\boldsymbol{D}_{t} & =\Pi_{z}(\pi_{t}^{UE},\pi_{t}^{EU})^{\prime}\underline{\boldsymbol{D}}_{t}\\
\underline{\boldsymbol{D}}_{t+1} & =\Lambda_{t}\boldsymbol{D}_{t}\\
 & \boldsymbol{\underline{D}}_{0}\text{ is given}
\end{align*}

\end_inset


\end_layout

\end_body
\end_document
